<!doctype html><html lang=en-us data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>HowTo :: SSH access using a GPG key for authentication - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Marcos Azevedo Blog"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Primary navigation"><a class="me-2 fs-4" href=/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Home</span>
</a><a class="mx-2 fs-4" href=/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Search</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Language><span class=fw-semibold>English</span>
<a href=/pt/howto/howto_ssh_with_gpg/>Português</a></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>HowTo :: SSH access using a GPG key for authentication</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1"><small>Date: <time>2018-10-02</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
8 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/howto title=Section>HowTo</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/howto title="categories: howto">howto</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/ssh title="tags: ssh">ssh</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/gpg title="tags: gpg">gpg</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#what-is-this-about>What is This About?</a></li><li><a href=#what-youll-need>What You&rsquo;ll Need</a></li><li><a href=#understanding-gpg-subkeys>Understanding GPG Subkeys</a></li><li><a href=#step-by-step-guide>Step-by-Step Guide</a><ul><li><a href=#step-1-create-an-authentication-subkey>Step 1: Create an Authentication Subkey</a></li><li><a href=#step-2-configure-gpg-agent-for-ssh>Step 2: Configure gpg-agent for SSH</a></li><li><a href=#step-3-pre-configure-ssh-keys-optional>Step 3: Pre-configure SSH Keys (Optional)</a></li><li><a href=#step-4-configure-shell-environment>Step 4: Configure Shell Environment</a></li><li><a href=#step-5-verify-the-setup>Step 5: Verify the Setup</a></li><li><a href=#step-6-share-your-public-key>Step 6: Share Your Public Key</a></li><li><a href=#step-7-test-ssh-connection>Step 7: Test SSH Connection</a></li></ul></li><li><a href=#troubleshooting>Troubleshooting</a></li><li><a href=#key-management-best-practices>Key Management Best Practices</a></li><li><a href=#next-steps>Next Steps</a></li><li><a href=#congratulations>Congratulations!</a></li><li><a href=#see-also>See Also</a></li></ul></nav></div><h2 id=introduction>Introduction</h2><p>Replace traditional SSH keys with GPG authentication subkeys, reducing the number of keys to manage while enabling GPG web of trust for SSH access distribution.</p><h2 id=what-is-this-about>What is This About?</h2><p>Many of us are familiar with Secure Shell (SSH), which allows us to connect to other systems using a key instead of a password. This guide will explain how to eliminate SSH keys and use a GNU Privacy Guard (GPG) subkey instead.</p><p><strong>Important clarification:</strong> Using GPG does not make your SSH connections more secure. SSH is already a secure protocol, and SSH keys are secure. Instead, this approach provides:</p><ul><li><strong>Simplified key management</strong> - One GPG key replaces multiple SSH keys</li><li><strong>Better backup strategy</strong> - Fewer keys to secure and back up</li><li><strong>GPG web of trust integration</strong> - Leverage existing GPG key distribution infrastructure</li><li><strong>Easier key distribution</strong> - Share keys via public keyservers instead of manual transfer</li></ul><p>Your SSH workflow remains unchanged - all commands work as expected, except you&rsquo;ll unlock your GPG key instead of managing separate SSH private keys.</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Why Use GPG for SSH?</div>Traditional SSH key distribution requires manual transfer (&ldquo;send me your public key&rdquo;). With GPG, you can distribute SSH keys via public keyservers using the established GPG web of trust. Organizations like <a href=https://monkeysphere.info/>The Monkeysphere Project</a> are building on this capability.</div><h2 id=what-youll-need>What You&rsquo;ll Need</h2><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Prerequisites</div><p>Before starting, ensure you have:</p><ul><li><strong>Existing GPG key pair</strong> - If you don&rsquo;t have one, see <a href=https://docs.fedoraproject.org/en-US/quick-docs/create-gpg-keys/>Fedora&rsquo;s GPG key creation guide</a></li><li><strong>SSH access to a remote system</strong> - For testing your setup</li><li><strong>gpg2 and gpg-agent</strong> installed (standard on most Linux distributions)</li><li><strong>Good passphrase hygiene</strong> - Your GPG key will authenticate SSH connections</li></ul></div><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Key Security Reminder</div><p>By having SSH authenticated by your GPG key, you reduce the number of key files to manage. However, your key management hygiene must still be excellent:</p><ul><li>Choose strong passphrases</li><li>Never back up private keys to the cloud</li><li>Use appropriate key preservation strategies</li><li>Consider hardware tokens for additional security</li></ul></div><h2 id=understanding-gpg-subkeys>Understanding GPG Subkeys</h2><p>A GPG key is actually a <strong>collection of keys</strong>, not just one:</p><ul><li><strong>Primary key</strong> - Used for signing and certification</li><li><strong>Encryption subkey</strong> - Created by default, used for encryption</li><li><strong>Authentication subkey</strong> - What we&rsquo;ll create for SSH</li></ul><p>Subkeys are separate keys signed by your primary key and transmitted together. This architecture allows you to revoke individual subkeys (e.g., if compromised) while keeping your primary key valid.</p><p>For SSH, we&rsquo;ll create an <strong>authentication subkey</strong> that completely replaces traditional SSH keypairs generated with <code>ssh-keygen</code>. You can create multiple authentication subkeys if you need different SSH keys for different purposes.</p><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Subkey Benefits</div><ul><li><strong>Revocation flexibility</strong> - Revoke compromised subkeys without affecting your primary key</li><li><strong>Selective distribution</strong> - Share only the subkeys you need for specific purposes</li><li><strong>Backup simplicity</strong> - Treat all keys as one for backup, but use them independently</li></ul></div><h2 id=step-by-step-guide>Step-by-Step Guide</h2><h3 id=step-1-create-an-authentication-subkey>Step 1: Create an Authentication Subkey</h3><p>You&rsquo;ll create the subkey by editing your existing GPG key in expert mode to access authentication options.</p><p>Start the key editing process:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg2 --expert --edit-key &lt;KEY_ID&gt;
</span></span></code></pre></td></tr></table></div></div><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Finding Your Key ID</div><p>List your GPG keys to find the key ID:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg2 --list-keys
</span></span></code></pre></td></tr></table></div></div><p>Use the 40-character fingerprint or the 8-character short ID shown in the output.</p></div><p>In the GPG prompt, add a new key:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg&gt; addkey
</span></span></code></pre></td></tr></table></div></div><p><strong>Select key type 8</strong> (RSA with custom capabilities):</p><pre tabindex=0><code>Your selection? 8
</code></pre><p><strong>Toggle capabilities</strong> to enable only Authentication:</p><ul><li>Type <code>s</code> to disable signing</li><li>Type <code>e</code> to disable encryption</li><li>Type <code>a</code> to enable authentication</li><li>Type <code>q</code> when only &ldquo;Authenticate&rdquo; is shown</li></ul><pre tabindex=0><code>Possible actions for a RSA key: Sign Encrypt Authenticate
Current allowed actions: Sign Encrypt

Your selection? s
Your selection? e
Your selection? a

Current allowed actions: Authenticate

Your selection? q
</code></pre><p><strong>Choose key size</strong>. SSH typically uses 2048-bit, but 4096-bit provides additional security:</p><pre tabindex=0><code>What keysize do you want? (2048) 4096
</code></pre><p><strong>Set expiration</strong>. Consider setting an expiration date (e.g., 2 years) as a security best practice:</p><pre tabindex=0><code>Key is valid for? (0) 2y
</code></pre><p>Or choose no expiration if you prefer:</p><pre tabindex=0><code>Key is valid for? (0) 0
</code></pre><p>Confirm your choices and enter your passphrase when prompted. You should see output showing your new authentication subkey (marked with <code>usage: A</code>):</p><pre tabindex=0><code>ssb rsa4096/136F0B4E3D42CF31
    created: 2019-03-21  expires: never     usage: A
</code></pre><p><strong>Save and exit:</strong></p><pre tabindex=0><code>gpg&gt; quit
Save changes? (y/N) y
</code></pre><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Remember Your Passphrase</div>You&rsquo;ll need your GPG passphrase every time you use SSH. Consider using a passphrase manager or gpg-agent caching to avoid repeated entry.</div><h3 id=step-2-configure-gpg-agent-for-ssh>Step 2: Configure gpg-agent for SSH</h3><p>The <code>gpg-agent</code> program will handle SSH authentication requests instead of <code>ssh-agent</code>.</p><p><strong>Enable SSH support</strong> in gpg-agent by adding this line to <code>~/.gnupg/gpg-agent.conf</code>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;enable-ssh-support&#34;</span> &gt;&gt; ~/.gnupg/gpg-agent.conf
</span></span></code></pre></td></tr></table></div></div><p>Verify the configuration:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat ~/.gnupg/gpg-agent.conf
</span></span></code></pre></td></tr></table></div></div><p>You should see:</p><pre tabindex=0><code>enable-ssh-support
</code></pre><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Optional: Additional gpg-agent Settings</div><p>Consider adding these options to <code>~/.gnupg/gpg-agent.conf</code>:</p><pre tabindex=0><code>default-cache-ttl 600
max-cache-ttl 7200
</code></pre><p>This caches your passphrase for 10 minutes (600 seconds), with a maximum of 2 hours.</p></div><h3 id=step-3-pre-configure-ssh-keys-optional>Step 3: Pre-configure SSH Keys (Optional)</h3><p>You can pre-specify which keys to use for SSH to avoid running <code>ssh-add</code> each time.</p><p><strong>Find your authentication subkey&rsquo;s keygrip:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg2 -K --with-keygrip
</span></span></code></pre></td></tr></table></div></div><p>Look for the subkey with <code>[A]</code> (authentication) capability:</p><pre tabindex=0><code>ssb   rsa2048 2019-03-21 [A]
      Keygrip = 2BE91C3C443AA29C3703D004587AD6DA9D7E40FC
</code></pre><p><strong>Add the keygrip to sshcontrol:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;2BE91C3C443AA29C3703D004587AD6DA9D7E40FC&#34;</span> &gt;&gt; ~/.gnupg/sshcontrol
</span></span></code></pre></td></tr></table></div></div><p>Replace the keygrip above with your actual keygrip value.</p><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">What is a Keygrip?</div>A keygrip is an internal identifier <code>gpg-agent</code> uses to refer to keys. Unlike a key hash, a keygrip refers to both the public and private key together.</div><h3 id=step-4-configure-shell-environment>Step 4: Configure Shell Environment</h3><p>Tell SSH how to access <code>gpg-agent</code> by setting the <code>SSH_AUTH_SOCK</code> environment variable.</p><p><strong>Add these lines to <code>~/.bashrc</code></strong> (or <code>~/.zshrc</code> if using zsh):</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export SSH_AUTH_SOCK<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gpgconf --list-dirs agent-ssh-socket<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>gpgconf --launch gpg-agent
</span></span></code></pre></td></tr></table></div></div><p><strong>Apply the configuration</strong> to your current session:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><p>Or start a new terminal session.</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">For Zsh Users</div>If you use zsh instead of bash, add the same lines to <code>~/.zshrc</code> instead of <code>~/.bashrc</code>.</div><h3 id=step-5-verify-the-setup>Step 5: Verify the Setup</h3><p>Check that <code>gpg-agent</code> is providing your SSH key:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-add -L
</span></span></code></pre></td></tr></table></div></div><p>You should see your GPG-based SSH public key printed. The key will have a comment indicating it&rsquo;s from GPG.</p><p>If you see &ldquo;The agent has no identities,&rdquo; restart <code>gpg-agent</code>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpgconf --kill gpg-agent
</span></span><span style=display:flex><span>gpgconf --launch gpg-agent
</span></span><span style=display:flex><span>ssh-add -L
</span></span></code></pre></td></tr></table></div></div><h3 id=step-6-share-your-public-key>Step 6: Share Your Public Key</h3><p>Distribute your public key to remote systems just like traditional SSH keys.</p><p><strong>Option 1: Manual copy</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-add -L
</span></span></code></pre></td></tr></table></div></div><p>Copy the output and manually add it to <code>~/.ssh/authorized_keys</code> on the remote system.</p><p><strong>Option 2: Use ssh-copy-id</strong> (recommended)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-copy-id user@remote-host
</span></span></code></pre></td></tr></table></div></div><p>This automatically copies your public key to the remote system.</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Nothing Changes for Remote Hosts</div>The remote systems you connect to don&rsquo;t need any configuration changes. They see your GPG authentication subkey as a standard SSH public key.</div><h3 id=step-7-test-ssh-connection>Step 7: Test SSH Connection</h3><p>Connect to a remote system as usual:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh user@remote-host
</span></span></code></pre></td></tr></table></div></div><p>You should be prompted for your GPG passphrase instead of an SSH key passphrase. After successful authentication, your passphrase will be cached according to your <code>gpg-agent</code> configuration.</p><h2 id=troubleshooting>Troubleshooting</h2><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Common Issues</div><p><strong>Issue:</strong> <code>ssh-add -L</code> shows &ldquo;The agent has no identities&rdquo;
<strong>Solution:</strong></p><ul><li>Verify <code>~/.gnupg/sshcontrol</code> contains your authentication keygrip</li><li>Restart gpg-agent: <code>gpgconf --kill gpg-agent && gpgconf --launch gpg-agent</code></li><li>Check <code>SSH_AUTH_SOCK</code> is set: <code>echo $SSH_AUTH_SOCK</code></li></ul><p><strong>Issue:</strong> SSH still asks for password instead of GPG passphrase
<strong>Solution:</strong></p><ul><li>Ensure your public key is in <code>~/.ssh/authorized_keys</code> on the remote system</li><li>Run <code>ssh-add -L</code> to verify your key is available</li><li>Check SSH connection with verbose output: <code>ssh -v user@host</code></li></ul><p><strong>Issue:</strong> &ldquo;sign_and_send_pubkey: signing failed: agent refused operation&rdquo;
<strong>Solution:</strong></p><ul><li>Your GPG key might be locked or expired</li><li>Try unlocking it: <code>echo "test" | gpg2 --sign --armor</code></li><li>Verify key expiration: <code>gpg2 -K</code></li></ul><p><strong>Issue:</strong> gpg-agent not starting automatically
<strong>Solution:</strong></p><ul><li>Verify <code>~/.bashrc</code> contains the export and launch commands</li><li>Source your bashrc: <code>source ~/.bashrc</code></li><li>Start a new terminal session</li></ul><p><strong>Issue:</strong> Passphrase asked every time despite caching
<strong>Solution:</strong></p><ul><li>Check <code>~/.gnupg/gpg-agent.conf</code> has cache settings</li><li>Restart gpg-agent after config changes</li><li>Consider using pinentry for better passphrase caching</li></ul></div><h2 id=key-management-best-practices>Key Management Best Practices</h2><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Maintaining Your GPG-SSH Setup</div><ul><li><strong>Regular backups</strong> - Export and securely store your GPG key: <code>gpg2 --export-secret-keys KEY_ID > private-key-backup.gpg</code></li><li><strong>Revocation certificate</strong> - Create one when you first make your key: <code>gpg2 --gen-revoke KEY_ID > revoke-cert.asc</code></li><li><strong>Key expiration</strong> - Set reasonable expiration dates and renew before they expire</li><li><strong>Subkey rotation</strong> - Periodically create new authentication subkeys and revoke old ones</li><li><strong>Monitor usage</strong> - Check <code>~/.gnupg/sshcontrol</code> to see which keys are in use</li><li><strong>Test recovery</strong> - Periodically test your backup and recovery procedures</li></ul></div><h2 id=next-steps>Next Steps</h2><p>Now that you have GPG-based SSH authentication:</p><ol><li><strong>Distribute via keyserver</strong> - Upload your GPG key to public keyservers so others can fetch your SSH key</li><li><strong>Explore Monkeysphere</strong> - Visit <a href=https://monkeysphere.info/>The Monkeysphere Project</a> to learn about GPG web of trust for SSH</li><li><strong>Hardware tokens</strong> - Consider using a YubiKey or other hardware token to store your GPG key</li><li><strong>Multiple authentication subkeys</strong> - Create different subkeys for different systems or purposes</li><li><strong>Remove old SSH keys</strong> - Once confident in your GPG setup, remove traditional SSH keys: <code>rm ~/.ssh/id_rsa*</code></li></ol><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">GPG Web of Trust for SSH</div><p>With GPG-authenticated SSH, you can leverage the GPG web of trust:</p><ul><li>Others can fetch your SSH key from keyservers</li><li>Key signing parties can authenticate SSH keys</li><li>Centralized key management for organizations</li><li>Automatic key rotation when you update your GPG key</li></ul></div><h2 id=congratulations>Congratulations!</h2><p>You&rsquo;ve successfully enabled SSH access using GPG authentication! Your SSH workflow remains identical from a user perspective, but you&rsquo;ve gained:</p><ul><li>Reduced number of keys to manage and back up</li><li>Ability to use GPG key distribution infrastructure for SSH</li><li>Unified authentication using your GPG identity</li><li>Better key lifecycle management with subkey capabilities</li></ul><p>Stay safe and practice good key hygiene!</p><h2 id=see-also>See Also</h2><ul><li><a href=/blog/cheatsheet_linux_shell_tricks/>Linux Shell Tricks Cheatsheet</a> - Master command-line efficiency</li><li><a href=https://docs.fedoraproject.org/en-US/quick-docs/create-gpg-keys/>Fedora GPG Key Creation Guide</a> - Create your first GPG key</li><li><a href=https://monkeysphere.info/>The Monkeysphere Project</a> - GPG web of trust for SSH</li><li><a href=https://www.gnupg.org/documentation/manuals/gnupg/>GnuPG Manual</a> - Complete GPG documentation</li></ul><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/howto/howto_install_gdb_gef/ data-toggle=tooltip data-placement=top title="HowTo :: Install GEF (GDB Plug-in)"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><i class="text-secondary fas fa-chevron-right" style=font-size:2em></i></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>