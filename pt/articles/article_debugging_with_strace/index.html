<!doctype html><html lang=pt-br data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Artigo :: Debugando com strace - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Blog do Marcos Azevedo"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Navegação principal"><a class="me-2 fs-4" href=/pt/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Início</span>
</a><a class="mx-2 fs-4" href=/pt/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/pt/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Buscar</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Idioma><a href=/articles/article_debugging_with_strace/>English</a>
<span class=fw-semibold>Português</span></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>Artigo :: Debugando com strace</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1"><small>Date: <time>2019-01-13</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
5 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/articles title=Section>Artigos</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/articles title="categories: articles">articles</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/linux title="tags: linux">linux</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/strace title="tags: strace">strace</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/debug title="tags: debug">debug</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/development title="tags: development">development</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#introdução>Introdução</a></li><li><a href=#visão-geral>Visão Geral</a></li><li><a href=#pré-requisitos>Pré-requisitos</a></li><li><a href=#o-que-é-strace>O que é strace?</a></li><li><a href=#rastreando-uma-execução>Rastreando uma Execução</a></li><li><a href=#filtrando-chamadas-de-sistema>Filtrando Chamadas de Sistema</a></li><li><a href=#anexando-a-processos-em-execução>Anexando a Processos em Execução</a></li><li><a href=#analisando-estatísticas-do-programa>Analisando Estatísticas do Programa</a></li><li><a href=#pontos-chave>Pontos-Chave</a></li><li><a href=#exercícios-práticos>Exercícios Práticos</a></li><li><a href=#leitura-adicional>Leitura Adicional</a></li></ul></nav></div><h2 id=introdução>Introdução</h2><p>Ao final deste artigo, você entenderá como usar o strace para depurar programas sem acesso ao código-fonte, rastrear chamadas de sistema e solucionar problemas de execução no Linux.</p><h2 id=visão-geral>Visão Geral</h2><p>Depurar sem código-fonte pode parecer resolver um quebra-cabeça no escuro. O strace ilumina o caminho mostrando exatamente quais chamadas de sistema um programa faz, desde abertura de arquivos até conexões de rede. Se você está solucionando um crash, investigando comportamento suspeito, ou apenas curioso sobre como um programa funciona por baixo dos panos, o strace é uma ferramenta essencial no seu kit Linux.</p><p>O strace monitora as chamadas de sistema e sinais de um programa específico, fornecendo a sequência de execução do início ao fim. É particularmente valioso quando você não tem acesso ao código-fonte e precisa entender o que um programa está realmente fazendo no nível do sistema.</p><h2 id=pré-requisitos>Pré-requisitos</h2><p>Antes de começar, você deve ter:</p><ul><li>Familiaridade básica com a linha de comando do Linux</li><li>Compreensão do que é um processo e como programas executam</li><li>Um sistema Linux com strace instalado (a maioria das distribuições já inclui por padrão)</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Verificar se o strace está instalado</div>Execute <code>which strace</code> ou <code>strace --version</code> para verificar a instalação. Se não estiver instalado, use seu gerenciador de pacotes: <code>sudo apt install strace</code> ou <code>sudo yum install strace</code>.</div><h2 id=o-que-é-strace>O que é strace?</h2><p>Strace é uma ferramenta de diagnóstico e depuração que intercepta e registra chamadas de sistema feitas por um processo. É particularmente útil quando:</p><ul><li>Você não tem acesso ao código-fonte</li><li>Um programa trava ou se comporta inesperadamente</li><li>Você precisa entender padrões de acesso a arquivos</li><li>Você está investigando gargalos de performance</li><li>Você quer ver o que um programa está fazendo &ldquo;por baixo dos panos&rdquo;</li></ul><h2 id=rastreando-uma-execução>Rastreando uma Execução</h2><p>A maneira mais simples de usar o strace é executá-lo com um programa:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace Binary_File
</span></span></code></pre></td></tr></table></div></div><p>Isso exibe toda chamada de sistema feita pelo programa no stderr, o que pode ser muito para programas complexos.</p><p><strong>Opções úteis:</strong></p><ul><li><code>-o saida.txt</code> - Grava a saída em um arquivo em vez do stderr</li><li><code>-t</code> - Mostra timestamps para cada chamada de sistema</li><li><code>-r</code> - Mostra timestamps relativos (tempo decorrido entre chamadas)</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Gerenciando Saída Grande</div><p>Para programas complexos, sempre use <code>-o</code> para gravar a saída em um arquivo:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace -o trace.log ./meuprograma
</span></span></code></pre></td></tr></table></div></div><p>Isso torna a saída muito mais fácil de pesquisar e analisar depois.</p></div><h2 id=filtrando-chamadas-de-sistema>Filtrando Chamadas de Sistema</h2><p>O verdadeiro poder do strace vem da filtragem. Use a opção <code>-e</code> para focar em chamadas de sistema específicas:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace -e socket,send,recv nc google.com <span style=color:#ae81ff>80</span>
</span></span></code></pre></td></tr></table></div></div><p>Isso mostra apenas chamadas relacionadas à rede, filtrando centenas de chamadas de sistema irrelevantes.</p><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Sintaxe de Filtro</div><p>Ao especificar múltiplas chamadas de sistema, <strong>não adicione espaços após as vírgulas</strong>:</p><ul><li>Correto: <code>-e open,read,write</code></li><li>Errado: <code>-e open, read, write</code> (vai falhar)</li></ul></div><p><strong>Categorias comuns de filtro:</strong></p><ul><li><code>-e trace=file</code> - Todas as operações de arquivo (open, read, write, close, stat)</li><li><code>-e trace=process</code> - Gerenciamento de processos (fork, exec, wait, exit)</li><li><code>-e trace=network</code> - Operações de rede (socket, connect, send, recv)</li><li><code>-e trace=signal</code> - Manipulação de sinais</li><li><code>-e trace=ipc</code> - Comunicação entre processos</li></ul><h2 id=anexando-a-processos-em-execução>Anexando a Processos em Execução</h2><p>Você pode anexar o strace a um processo já em execução usando seu PID:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace -p PID
</span></span></code></pre></td></tr></table></div></div><p>Isso é inestimável para depurar sistemas ao vivo sem reiniciar serviços.</p><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Impacto de Performance</div>Anexar o strace a um processo em execução <strong>vai deixá-lo significativamente mais lento</strong>. O processo deve fazer context-switch para cada chamada de sistema, e o strace adiciona overhead. Use com cuidado em ambientes de produção.</div><p><strong>Exemplo:</strong> Depurar um servidor web travado:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Encontre o PID</span>
</span></span><span style=display:flex><span>ps aux | grep nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Anexe o strace (pode requerer sudo)</span>
</span></span><span style=display:flex><span>sudo strace -p <span style=color:#ae81ff>1234</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=analisando-estatísticas-do-programa>Analisando Estatísticas do Programa</h2><p>A flag <code>-c</code> fornece um relatório resumido em vez de saída detalhada, mostrando:</p><ul><li>Tempo gasto em cada chamada de sistema</li><li>Número de vezes que cada chamada foi feita</li><li>Erros encontrados</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace -c binary_file argumentos
</span></span></code></pre></td></tr></table></div></div><p>Isso é perfeito para análise de performance e identificação de gargalos.</p><p><strong>Exemplo de saída:</strong></p><pre tabindex=0><code>% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 45.12    0.012345          23       537           read
 32.45    0.008876          45       197           write
 12.34    0.003376         112        30           open
</code></pre><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Combine -c com filtros</div><p>Use <code>-c</code> com <code>-e</code> para obter estatísticas de tipos específicos de chamadas:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>strace -c -e trace<span style=color:#f92672>=</span>file ./meuprograma
</span></span></code></pre></td></tr></table></div></div><p>Isso mostra apenas as estatísticas de chamadas de sistema relacionadas a arquivos.</p></div><h2 id=pontos-chave>Pontos-Chave</h2><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Resumo Rápido</div><ul><li><strong>strace</strong> revela chamadas de sistema feitas por programas, essencial para depuração sem código-fonte</li><li>Use <strong>-e</strong> para filtrar chamadas de sistema e reduzir ruído na saída</li><li>Use <strong>-p PID</strong> para anexar a processos em execução (cuidado em produção!)</li><li>Use <strong>-c</strong> para análise de performance e estatísticas de chamadas</li><li>Grave a saída em arquivos com <strong>-o</strong> para facilitar a análise</li><li>Entender chamadas de sistema ajuda você a ver o que os programas realmente fazem no nível do SO</li></ul></div><h2 id=exercícios-práticos>Exercícios Práticos</h2><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Experimente Você Mesmo</div><ol><li>Execute <code>strace ls /tmp</code> e identifique as chamadas de sistema usadas para ler o diretório</li><li>Use <code>strace -e open cat /etc/passwd</code> para ver quais arquivos o <code>cat</code> abre antes de ler seu arquivo alvo</li><li>Crie um script Python simples e use <code>strace -c</code> para analisar quais chamadas de sistema dominam</li><li>Anexe o strace a um processo de longa duração (como um editor de texto) e observe suas chamadas de sistema durante tempo ocioso</li></ol></div><h2 id=leitura-adicional>Leitura Adicional</h2><ul><li><a href=/blog/article_getting_start_with_gdb.pt/>Começando com GDB</a> - Aprenda depuração em nível de código com GDB</li><li><a href=/blog/article_linux_syscalls_in_assembly.pt/>Syscalls do Linux em Assembly</a> - Entenda chamadas de sistema em um nível mais profundo</li><li><a href=https://man7.org/linux/man-pages/man1/strace.1.html>Página man do strace</a> - Documentação de referência completa</li></ul><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><i class="text-secondary bi bi-chevron-left" style=font-size:2em></i></div><div class=ms-4><a href=/pt/articles/article_linux_syscalls_in_assembly/ data-toggle=tooltip data-placement=top title="Artigo :: Usando syscalls do Linux em Assembly"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>