<!doctype html><html lang=pt-br data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Ponto flutuante, endianness e bit-packing (verificando com Python) - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Blog do Marcos Azevedo"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Navegação principal"><a class="me-2 fs-4" href=/pt/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Início</span>
</a><a class="mx-2 fs-4" href=/pt/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/pt/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Buscar</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Idioma><a href=/series/experimenting-with-risc-v/13-floats-endianness-bitpacking/>English</a>
<span class=fw-semibold>Português</span></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>Ponto flutuante, endianness e bit-packing (verificando com Python)</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1">Author: Marcos Azevedo</div><div class="metadata-value mb-1"><small>Date: <time>2026-01-20</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
5 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/series title=Section>Series</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/series title="categories: series">series</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/c-lang title="tags: c-lang">c-lang</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/programming title="tags: programming">programming</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/risc-v title="tags: risc-v">risc-v</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#1-o-básico-de-ieee-754-que-você-realmente-precisa>1. O básico de IEEE-754 que você realmente precisa</a><ul><li><a href=#float-32-bit>float (32-bit)</a></li><li><a href=#double-64-bit>double (64-bit)</a></li></ul></li><li><a href=#2-por-que-um-double-vira-dois-word-no-rv32>2. Por que um double vira dois .word no RV32</a></li><li><a href=#3-na-prática-produzir-uma-constante-double-em-assembly>3. Na prática: produzir uma constante double em assembly</a></li><li><a href=#4-verifique-os-bits-exatos-com-python-struct>4. Verifique os bits exatos com Python (struct)</a><ul><li><a href=#empacote-um-double-em-bytes>Empacote um double em bytes</a></li><li><a href=#divida-em-duas-words-de-32-bits-little-endian>Divida em duas words de 32 bits (little-endian)</a></li></ul></li><li><a href=#5-o-caminho-inverso-reconstruir-o-double-a-partir-das-words>5. O caminho inverso: reconstruir o double a partir das words</a></li><li><a href=#6-sanity-check-rápido-de-endian>6. Sanity check rápido de endian</a></li><li><a href=#7-e-as-instruções-de-ponto-flutuante-no-rv32>7. E as instruções de ponto flutuante no RV32?</a></li><li><a href=#8-casos-práticos-de-engenharia-reversa>8. Casos práticos de engenharia reversa</a></li><li><a href=#exercícios>Exercícios</a><ul><li><a href=#como-testar-suas-respostas>Como testar suas respostas</a></li></ul></li><li><a href=#resumo>Resumo</a></li></ul></nav></div><h2 id=tldr>TL;DR</h2><ul><li>Você vai aprender como <code>float</code> e <code>double</code> são representados (IEEE-754 (Institute of Electrical and Electronics Engineers 754)) e como esses padrões de bits aparecem em assembly e em um hexdump.</li><li>Vai entender por que compiladores às vezes emitem uma constante <code>double</code> como dois valores <code>.word</code> de 32 bits no RV32.</li><li>Vai aprender um método confiável de verificação: usar <code>struct</code> do Python para pack/unpack e comparar com o que você vê no disassembly.</li></ul><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Important</div>“Números em assembly” são apenas bytes. Se você consegue converter entre bytes ↔ bits ↔ significado numérico, você valida constantes, tabelas e protocolos com confiança.</div><hr><h2 id=1-o-básico-de-ieee-754-que-você-realmente-precisa>1. O básico de IEEE-754 que você realmente precisa</h2><h3 id=float-32-bit>float (32-bit)</h3><ul><li>1 bit de sinal</li><li>8 bits de expoente</li><li>23 bits de fração</li></ul><h3 id=double-64-bit>double (64-bit)</h3><ul><li>1 bit de sinal</li><li>11 bits de expoente</li><li>52 bits de fração</li></ul><p>Fatos práticos importantes:</p><ul><li><code>double</code> tem <strong>8 bytes</strong> (64 bits).</li><li>Em RV32 little-endian, esses 8 bytes aparecem com o byte menos significativo no menor endereço.</li></ul><hr><h2 id=2-por-que-um-double-vira-dois-word-no-rv32>2. Por que um double vira dois .word no RV32</h2><p>RV32 tem registradores de propósito geral de 32 bits, e muitas toolchains representam constantes em blocos de 32 bits.</p><p>Então o compilador pode emitir:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>.LC0:
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>.word</span>  <span style=color:#ae81ff>962072674</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>.word</span>  <span style=color:#ae81ff>1083394740</span>
</span></span></code></pre></td></tr></table></div></div><p>Isso é simplesmente <strong>64 bits</strong>, divididos em <strong>32 bits baixos</strong> e <strong>32 bits altos</strong> (por causa do layout little-endian).</p><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Note</div>Dependendo da sintaxe do assembler e da toolchain, você também pode ver <code>.dword</code> ou <code>.quad</code> para constantes de 64 bits.</div><hr><h2 id=3-na-prática-produzir-uma-constante-double-em-assembly>3. Na prática: produzir uma constante double em assembly</h2><p>Crie:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// src/double_const.c
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;types.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;uart.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>double</span> g <span style=color:#f92672>=</span> <span style=color:#ae81ff>1234.676</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>__attribute__</span>((noinline))
</span></span><span style=display:flex><span><span style=color:#66d9ef>double</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> g;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>union</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>double</span> d;
</span></span><span style=display:flex><span>    u32 w[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>  } u;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  u.d <span style=color:#f92672>=</span> <span style=color:#a6e22e>f</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uart_puts</span>(<span style=color:#e6db74>&#34;lo=&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uart_puthex32</span>(u.w[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uart_puts</span>(<span style=color:#e6db74>&#34; hi=&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uart_puthex32</span>(u.w[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uart_putc</span>(<span style=color:#e6db74>&#39;\n&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Compile para assembly:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-gcc -S -O0 -ffreestanding -nostdlib -march<span style=color:#f92672>=</span>rv32im -mabi<span style=color:#f92672>=</span>ilp32 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -o build/double_const.s src/double_const.c
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sed -n <span style=color:#e6db74>&#39;1,200p&#39;</span> build/double_const.s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>riscv64-unknown-elf-gcc -O0 -g -ffreestanding -nostdlib -march<span style=color:#f92672>=</span>rv32im -mabi<span style=color:#f92672>=</span>ilp32 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -T src/link.ld src/start.s src/uart.c src/double_const.c -o build/double_const.elf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>qemu-system-riscv32 -M virt -nographic -bios none -kernel build/double_const.elf
</span></span></code></pre></td></tr></table></div></div><p>Procure rótulos <code>.LC*</code> e os words emitidos.</p><hr><h2 id=4-verifique-os-bits-exatos-com-python-struct>4. Verifique os bits exatos com Python (struct)</h2><h3 id=empacote-um-double-em-bytes>Empacote um double em bytes</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>1234.676</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;d&#39;</span>, x)  <span style=color:#75715e># little-endian double</span>
</span></span><span style=display:flex><span>print(b<span style=color:#f92672>.</span>hex())
</span></span></code></pre></td></tr></table></div></div><ul><li><code>'&lt;d'</code> significa little-endian (<code>&lt;</code>) e double (<code>d</code>).</li></ul><h3 id=divida-em-duas-words-de-32-bits-little-endian>Divida em duas words de 32 bits (little-endian)</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>1234.676</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;d&#39;</span>, x)
</span></span><span style=display:flex><span>lo, hi <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74>&#39;&lt;II&#39;</span>, b)   <span style=color:#75715e># dois ints unsigned de 32 bits</span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;lo =&#39;</span>, lo)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;hi =&#39;</span>, hi)
</span></span></code></pre></td></tr></table></div></div><p>Se o seu assembly mostra:</p><ul><li><code>.word &lt;lo></code></li><li><code>.word &lt;hi></code></li></ul><p>…então bate exatamente.</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tip</div>Para casar exatamente com o disassembly, seja explícito sobre endianness (<code>&lt;</code> little, <code>></code> big) e tamanhos (<code>I</code> = 32-bit unsigned, <code>Q</code> = 64-bit unsigned).</div><hr><h2 id=5-o-caminho-inverso-reconstruir-o-double-a-partir-das-words>5. O caminho inverso: reconstruir o double a partir das words</h2><p>Se você só tem dois valores <code>.word</code> no assembly:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>lo <span style=color:#f92672>=</span> <span style=color:#ae81ff>962072674</span>
</span></span><span style=display:flex><span>hi <span style=color:#f92672>=</span> <span style=color:#ae81ff>1083394740</span>
</span></span><span style=display:flex><span>b <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&lt;II&#39;</span>, lo, hi)
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>unpack(<span style=color:#e6db74>&#39;&lt;d&#39;</span>, b)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>print(x)
</span></span></code></pre></td></tr></table></div></div><p>Isso retorna o <code>double</code> exato representado por aqueles bits.</p><hr><h2 id=6-sanity-check-rápido-de-endian>6. Sanity check rápido de endian</h2><p>Se você empacotar com big-endian por engano:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span>x <span style=color:#f92672>=</span> <span style=color:#ae81ff>1234.676</span>
</span></span><span style=display:flex><span>print(struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;d&#39;</span>, x)<span style=color:#f92672>.</span>hex())
</span></span></code></pre></td></tr></table></div></div><p>Você verá os bytes invertidos em relação à representação little-endian. Essa é uma fonte de confusão muito comum ao correlacionar hexdumps com valores numéricos.</p><hr><h2 id=7-e-as-instruções-de-ponto-flutuante-no-rv32>7. E as instruções de ponto flutuante no RV32?</h2><p>Ponto flutuante no RISC-V depende de extensões da ISA:</p><ul><li><code>F</code> (float precisão simples)</li><li><code>D</code> (double precisão dupla)</li></ul><p>Se você compila com um ABI que espera registradores de float (como <code>ilp32d</code>), a convenção de chamada muda para parâmetros/retornos de ponto flutuante.</p><p>Em muitos casos embarcados você usará <strong>soft-float</strong> (operações de ponto flutuante em software), o que afeta desempenho e o formato do disassembly.</p><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Warning</div>Se o seu alvo não tem hardware <code>F/D</code>, compilar com um ABI hard-float pode produzir binários que falham ou se comportam de forma incorreta.</div><hr><h2 id=8-casos-práticos-de-engenharia-reversa>8. Casos práticos de engenharia reversa</h2><ul><li>Identificar tabelas de lookup em <code>.rodata</code> (seno, constantes de calibração)</li><li>Verificar campos de protocolo (codificações fixed-point)</li><li>Confirmar se “constantes misteriosas” no firmware são floats/doubles</li></ul><p>Uma heurística rápida:</p><ul><li>Se você vê padrões repetitivos que parecem aleatórios mas estáveis, e alinhamento de 4/8 bytes, suspeite de tabelas de float.</li></ul><hr><h2 id=exercícios>Exercícios</h2><ol><li>Repita o experimento com um <code>double</code> negativo (ex.: <code>-0.125</code>) e verifique o efeito do bit de sinal.</li><li>Pegue um par de constantes <code>.word</code> do seu próprio firmware/ELF e tente reconstruir o <code>double</code> com Python.</li><li>Crie uma constante <code>float</code> e verifique sua representação de 32 bits com <code>struct.pack('&lt;f', x)</code> e <code>struct.unpack('&lt;I', ...)</code>.</li><li>Faça dump de <code>.rodata</code> com <code>objdump -s -j .rodata</code> e tente decodificar os primeiros 3 <code>double</code> que encontrar.</li></ol><h3 id=como-testar-suas-respostas>Como testar suas respostas</h3><ul><li>As words derivadas no Python devem bater exatamente com os valores <code>.word</code> do assembler.</li><li>Floats/doubles reconstruídos devem bater com o valor impresso dentro do erro de arredondamento esperado.</li></ul><hr><h2 id=resumo>Resumo</h2><p>Você aprendeu como floats/doubles viram bytes, por que RV32 costuma emitir constantes de 64 bits como dois <code>.word</code>, e como verificar tudo com Python usando bit-packing.</p><p>A seguir: <strong>debug com QEMU + GDB</strong>, vamos combinar o que você aprendeu para inspecionar registradores, memória e fluxo de controle de forma disciplinada.</p><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/pt/series/experimenting-with-risc-v/12-linker-scripts-memory-map/ data-toggle=tooltip data-placement=top title="Scripts de linker, seções e mapas de memória"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><a href=/pt/series/experimenting-with-risc-v/14-firmware-triage-reverse-workflow/ data-toggle=tooltip data-placement=top title="Triage de firmware e fluxo de engenharia reversa"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>