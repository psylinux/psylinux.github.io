<!doctype html><html lang=pt-br data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Instruções básicas de assembly RISC-V - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Blog do Marcos Azevedo"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Navegação principal"><a class="me-2 fs-4" href=/pt/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Início</span>
</a><a class="mx-2 fs-4" href=/pt/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/pt/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Buscar</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Idioma><a href=/series/experimenting-with-risc-v/05-basic-assembly/>English</a>
<span class=fw-semibold>Português</span></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>Instruções básicas de assembly RISC-V</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1">Author: Marcos Azevedo</div><div class="metadata-value mb-1"><small>Date: <time>2026-01-20</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
6 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/series title=Section>Series</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/series title="categories: series">series</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/c-lang title="tags: c-lang">c-lang</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/programming title="tags: programming">programming</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/risc-v title="tags: risc-v">risc-v</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#1-objetivo>1. Objetivo</a></li><li><a href=#2-famílias-de-instruções>2. Famílias de instruções</a></li><li><a href=#3-exemplo-somar-dois-números-e-armazenar-o-resultado>3. Exemplo: somar dois números e armazenar o resultado</a></li><li><a href=#4-linker-script-mínimo-e-por-que-isso-importa>4. Linker script mínimo (e por que isso importa)</a><ul><li><a href=#41-crie-um-linker-script-mínimo>4.1. Crie um linker script mínimo:</a></li><li><a href=#42-o-linker-script>4.2. O linker script</a></li><li><a href=#43-build-e-execução-no-qemu>4.3. Build e execução no QEMU</a></li></ul></li><li><a href=#5-conectar-com-gdb-multiarch>5. Conectar com gdb-multiarch</a></li><li><a href=#6-exercícios>6. Exercícios</a></li><li><a href=#7-resumo>7. Resumo</a></li></ul></nav></div><h2 id=1-objetivo>1. Objetivo</h2><p>Aprender as famílias centrais de instruções do RV32I e praticar com um pequeno programa escrito à mão.</p><h2 id=2-famílias-de-instruções>2. Famílias de instruções</h2><ul><li><strong>Aritmética</strong>: <code>add</code>, <code>addi</code>, <code>sub</code></li><li><strong>Loads/stores</strong>: <code>lw</code>, <code>sw</code>, <code>lb</code>, <code>sb</code></li><li><strong>Branches</strong>: <code>beq</code>, <code>bne</code>, <code>blt</code>, <code>bge</code></li><li><strong>Jumps</strong>: <code>jal</code>, <code>jalr</code></li></ul><h2 id=3-exemplo-somar-dois-números-e-armazenar-o-resultado>3. Exemplo: somar dois números e armazenar o resultado</h2><p>Arquivo: <code>src/basic_add.s</code></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.section .text
</span></span><span style=display:flex><span>.globl _start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_start:
</span></span><span style=display:flex><span>  li t0, <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span>  li t1, <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  add t2, t0, t1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  la t3, g_result
</span></span><span style=display:flex><span>  sw t2, 0<span style=color:#f92672>(</span>t3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1:
</span></span><span style=display:flex><span>  j 1b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.section .bss
</span></span><span style=display:flex><span>.align <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>g_result:
</span></span><span style=display:flex><span>  .word <span style=color:#ae81ff>0</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=4-linker-script-mínimo-e-por-que-isso-importa>4. Linker script mínimo (e por que isso importa)</h2><p>Quando você roda assembly bare-metal, não há sistema operacional nem runtime C para decidir onde o seu código e dados vivem na memória. O <strong>C Runtime (CRT)</strong> é o código que roda antes do seu <code>main()</code> e depois que ele termina.
Ele prepara o ambiente de execução de um programa C: pilha, argumentos, variáveis globais, bibliotecas, e só então chama <code>main()</code>.</p><p>Nota curta sobre CRT (o que é e o que não é):</p><ul><li><strong>CRT não é libc</strong>. É uma camada mínima de inicialização/finalização, normalmente dividida em objetos como <code>crt1.o</code>, <code>crti.o</code> e <code>crtn.o</code>.</li><li><strong>O kernel não chama <code>main()</code></strong>. O ponto de entrada é <code>_start</code>; o CRT fornece <code>_start</code> e depois chama <code>main()</code> para você.</li><li><strong>Sem CRT não há startup automático</strong>. Se você omite o CRT (como em bare-metal), precisa implementar <code>_start</code> por conta própria.</li></ul><p>Sem CRT (C Runtime):</p><ul><li>Não há <code>main()</code> automático</li><li>Você precisa fornecer <code>_start</code></li><li>Você fala diretamente com o kernel via syscalls (System Calls)</li></ul><p>O linker precisa de instruções explícitas sobre:</p><ul><li><strong>Ponto de entrada</strong>: onde a execução começa (<code>_start</code>).</li><li><strong>Endereço de memória</strong>: onde a imagem deve ser colocada (a máquina <code>virt</code> do QEMU espera RAM em <code>0x80000000</code>).</li><li><strong>Layout de seções</strong>: onde <code>.text</code>, <code>.rodata</code>, <code>.data</code> e <code>.bss</code> ficam.</li></ul><h3 id=41-crie-um-linker-script-mínimo>4.1. Crie um linker script mínimo:</h3><p>Arquivo: <code>src/minimal_link.ld</code></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ENTRY<span style=color:#f92672>(</span>_start<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SECTIONS
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  . <span style=color:#f92672>=</span> 0x80000000;
</span></span><span style=display:flex><span>  .text : <span style=color:#f92672>{</span> *<span style=color:#f92672>(</span>.text .text.*<span style=color:#f92672>)</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  .rodata : <span style=color:#f92672>{</span> *<span style=color:#f92672>(</span>.rodata .rodata.*<span style=color:#f92672>)</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  .data : <span style=color:#f92672>{</span> *<span style=color:#f92672>(</span>.data .data.*<span style=color:#f92672>)</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  .bss : <span style=color:#f92672>{</span> *<span style=color:#f92672>(</span>.bss .bss.* COMMON<span style=color:#f92672>)</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=42-o-linker-script>4.2. O linker script</h3><p>Estas são as instruções para o Linker. Pense no Linker como um construtor que pega pilhas de matéria-prima (as linhas compiladas do seu código) e as organiza em um prédio finalizado (o binário executável).</p><ul><li><p><strong><code>ENTRY(_start)</code></strong></p><ul><li><strong>A porta de entrada</strong>: diz ao linker: &ldquo;Quando o computador carregar este programa, a primeira instrução a executar está no rótulo <code>_start</code>.&rdquo;</li><li>Sem isso, o processador não saberia onde começar.</li></ul></li><li><p><strong><code>SECTIONS { ... }</code></strong></p><ul><li><strong>O blueprint</strong>: define o mapa de memória. Diz ao linker exatamente onde colocar cada parte do seu programa na RAM.</li></ul></li><li><p><strong><code>. = 0x80000000;</code></strong></p><ul><li><strong>O contador de localização atual (<code>.</code>)</strong>: pense no ponto <code>.</code> como um cursor apontando para um endereço de memória.</li><li><strong><code>0x80000000</code></strong>: essas linhas colocam o cursor nesse endereço específico.</li><li><strong>Por que esse número?</strong> Em muitos sistemas RISC-V (como a máquina <code>virt</code> do QEMU), a RAM física começa em <code>0x80000000</code>. Endereços menores costumam ser registradores de hardware ou flash. Esta linha diz: &ldquo;Comece a colocar nosso programa no início da RAM.&rdquo;</li></ul></li><li><p><strong><code>.text : { *(.text .text.*) }</code></strong></p><ul><li><strong>A seção de código</strong>: <code>.text</code> é onde seu código executável (instruções assembly) vive.</li><li><strong><code>{ *(.text) }</code></strong>: significa &ldquo;Pegue a seção <code>.text</code> de todos os arquivos de entrada (<code>*</code>) e coloque aqui.&rdquo;</li><li>Como o cursor acabou de ser colocado em <code>0x80000000</code>, o código vai primeiro.</li></ul></li><li><p><strong><code>.rodata : { *(.rodata .rodata.*) }</code></strong></p><ul><li><strong>Dados somente leitura</strong>: constantes, como literais de string (&ldquo;Hello World&rdquo;) que não devem mudar.</li><li>Elas ficam imediatamente após o código.</li></ul></li><li><p><strong><code>.data : { *(.data .data.*) }</code></strong></p><ul><li><strong>Dados inicializados</strong>: variáveis globais com valor inicial (ex.: <code>int score = 10;</code>).</li><li>Elas ficam depois de dados somente leitura.</li></ul></li><li><p><strong><code>.bss : { *(.bss .bss.* COMMON) }</code></strong></p><ul><li><strong>Dados não inicializados</strong>: <code>bss</code> significa &ldquo;Block Started by Symbol&rdquo; (termo histórico). Idealmente guarda variáveis globais sem valor ainda (ex.: <code>int buffer[100];</code>).</li><li>O linker não grava zeros no arquivo para economizar espaço; ele apenas marca que esse espaço precisa ser reservado na RAM.</li></ul></li></ul><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Warning</div><p><strong>Por que a ordem importa</strong></p><p>Ao criar um linker script para assembly bare-metal, sempre coloque <code>.text</code> primeiro! A CPU salta cegamente para o endereço base (<code>0x80000000</code>). Se você colocar dados (como <code>.rodata</code>) primeiro, a CPU vai tentar “executar” bytes de dados como instruções, causando crash imediato. Embora loaders mais inteligentes (como o QEMU com <code>-kernel</code>) possam lidar com isso lendo o entry point do ELF, payloads binários crus em hardware real falharão.</p></div><h3 id=43-build-e-execução-no-qemu>4.3. Build e execução no QEMU</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-gcc -O0 -g -ffreestanding -nostdlib -march<span style=color:#f92672>=</span>rv32im -mabi<span style=color:#f92672>=</span>ilp32 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -T src/minimal_link.ld src/basic_add.s -o build/basic_add.elf
</span></span></code></pre></td></tr></table></div></div><p>O terminal vai travar por causa do loop infinito no final do programa. Isso é esperado. Para verificar o resultado, abra outro terminal e use <code>gdb-multiarch</code> para inspecionar a memória como explicado na próxima seção.</p><h2 id=5-conectar-com-gdb-multiarch>5. Conectar com gdb-multiarch</h2><p>Para depurar, inicie o QEMU com o stub do GDB habilitado e pausado no reset:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qemu-system-riscv32 -M virt -nographic -bios none -kernel build/basic_add.elf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -S -gdb tcp::1234
</span></span></code></pre></td></tr></table></div></div><p>Em outro terminal, conecte-se manualmente usando <code>gdb-multiarch</code> e siga cada passo abaixo:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gdb-multiarch build/basic_add.elf
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> set architecture riscv:rv32
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> target remote :1234
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> break _start
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> <span style=color:#66d9ef>continue</span>
</span></span></code></pre></td></tr></table></div></div><p>Se preferir um comando único, você pode rodar:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gdb-multiarch build/basic_add.elf -q <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -ex <span style=color:#e6db74>&#34;set arch riscv:rv32&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -ex <span style=color:#e6db74>&#34;target remote localhost:1234&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -ex <span style=color:#e6db74>&#34;break _start&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -ex <span style=color:#e6db74>&#34;continue&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Agora você pode inspecionar o resultado:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> info variables g_result
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> print &amp;g_result
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> next
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/wx &amp;g_result
</span></span></code></pre></td></tr></table></div></div><p>A saída deve mostrar <code>0x0000002a</code>, que é <code>42</code> em decimal (<code>40 + 2</code>).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Reading symbols from build/basic_add.elf...
</span></span><span style=display:flex><span>The target architecture is set to <span style=color:#e6db74>&#34;riscv:rv32&#34;</span>.
</span></span><span style=display:flex><span>Remote debugging using localhost:1234
</span></span><span style=display:flex><span>0x00001000 in ?? <span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>Breakpoint <span style=color:#ae81ff>1</span> at 0x80000000: file src/basic_add.s, line 5.
</span></span><span style=display:flex><span>Continuing.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Breakpoint 1, _start <span style=color:#f92672>()</span> at src/basic_add.s:5
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>         li t0, <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span>         li t1, <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span><span style=color:#ae81ff>7</span>         add t2, t0, t1
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span>         la t3, g_result
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span>0x80000010      <span style=color:#ae81ff>9</span>         la t3, g_result
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>        sw t2, 0<span style=color:#f92672>(</span>t3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> ni
</span></span><span style=display:flex><span><span style=color:#ae81ff>13</span>        j 1b
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/wd &amp;g_result
</span></span><span style=display:flex><span>0x80000020:     <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> q
</span></span></code></pre></td></tr></table></div></div><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tip</div><ul><li>Para sair do GDB, digite <code>quit</code> ou <code>q</code>.</li><li>Para parar o QEMU, use <code>Ctrl+a x</code> no terminal dele.</li></ul></div><h2 id=6-exercícios>6. Exercícios</h2><ol><li>Altere as constantes para calcular <code>7 + 13</code> e verifique na memória.</li><li>Substitua <code>add</code> por <code>sub</code> e observe o novo resultado.</li><li>Adicione um loop que incrementa <code>g_result</code> cinco vezes.</li></ol><h2 id=7-resumo>7. Resumo</h2><ul><li>Instruções RV32I são pequenas e ortogonais.</li><li>Um programa mínimo pode rodar sem libc ao definir <code>_start</code>.</li><li>QEMU + GDB permite inspecionar resultados diretamente na memória.</li></ul><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/pt/series/experimenting-with-risc-v/04-setup-toolchain/ data-toggle=tooltip data-placement=top title="Configurando a toolchain e o QEMU"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><a href=/pt/series/experimenting-with-risc-v/06-elf-and-binutils/ data-toggle=tooltip data-placement=top title="Internals de ELF e Binutils: vendo o que o compilador produziu"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>