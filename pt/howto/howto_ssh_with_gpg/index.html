<!doctype html><html lang=pt-br data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>HowTo :: Acesso SSH usando chave GPG para autenticação - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Blog do Marcos Azevedo"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Navegação principal"><a class="me-2 fs-4" href=/pt/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Início</span>
</a><a class="mx-2 fs-4" href=/pt/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/pt/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Buscar</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Idioma><a href=/howto/howto_ssh_with_gpg/>English</a>
<span class=fw-semibold>Português</span></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>HowTo :: Acesso SSH usando chave GPG para autenticação</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1"><small>Date: <time>2018-10-02</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
6 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/howto title=Section>HowTo</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/howto title="categories: howto">howto</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/ssh title="tags: ssh">ssh</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/gpg title="tags: gpg">gpg</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#prefácio>Prefácio</a></li><li><a href=#o-que-é-uma-subchave-gpg>O que é uma subchave GPG?</a></li><li><a href=#crie-uma-subchave-de-autenticação>Crie uma subchave de autenticação</a></li><li><a href=#habilite-a-subchave-gpg>Habilite a subchave GPG</a></li><li><a href=#compartilhe-sua-chave-ssh>Compartilhe sua chave SSH</a></li><li><a href=#parabéns>Parabéns!</a></li></ul></nav></div><h2 id=prefácio>Prefácio</h2><p>Muitos de nós já conhecemos o Secure Shell (SSH), que permite conectar a outros sistemas usando uma chave em vez de senha. Este guia explica como eliminar chaves SSH e usar uma subchave do GNU Privacy Guard (GPG) no lugar. Usar GPG não torna suas conexões SSH mais seguras. SSH é um protocolo seguro, e chaves SSH são seguras. Em vez disso, isso torna mais fácil certos aspectos de distribuição de chaves e gestão de backups. Também não muda seu workflow de uso do SSH. Todos os comandos continuarão funcionando como você espera, exceto que você não terá mais chaves privadas SSH, você vai desbloquear sua chave GPG.</p><p>Ao autenticar o SSH com sua chave GPG, você reduz o número de arquivos de chave que precisa proteger e fazer backup. Isso significa que sua higiene de gerenciamento de chaves precisa continuar boa, o que implica escolher boas passphrases e usar estratégias apropriadas de preservação de chaves. Lembre-se: você não deve fazer backup da sua chave privada na nuvem!</p><p>Além disso, hoje chaves SSH são distribuídas manualmente e muitas vezes diretamente. Se você quiser me dar acesso a uma máquina, precisa me pedir minha chave SSH. Você até pode encontrar uma publicada no meu site. Porém, ainda precisa decidir se confia no meu site. Se eu usar uma chave GPG para SSH, você pode selecionar uma chave conhecida e confiável para mim usando a web of trust do GPG a partir de um keyserver público. É nisso que o <a href=https://monkeysphere.info/>The Monkeysphere Project</a> está trabalhando. Caso contrário, nada do que você fizer aqui afeta a web of trust usada para criptografia e assinatura com GPG.</p><h2 id=o-que-é-uma-subchave-gpg>O que é uma subchave GPG?</h2><p>Uma chave GPG é, na verdade, um conjunto de chaves. Há uma chave primária, normalmente usada apenas para assinatura e certificação. A prática sugerida no uso do GPG é criar uma subchave para criptografia. Essa subchave é separada e, para todos os fins práticos, é assinada pela chave primária e transmitida ao mesmo tempo. Essa prática permite revogar a subchave de criptografia isoladamente, por exemplo se ela for comprometida, mantendo a chave primária válida. O importante é perceber que uma chave GPG contém múltiplas chaves. Para backup e armazenamento, você pode tratá-las como uma única chave, mas na hora de usar você pode utilizá-las de forma independente.</p><p>Este exercício vai usar uma subchave criada para autenticação para completar conexões SSH. Essa subchave de autenticação vai substituir completamente o par de chaves que você talvez tenha gerado no passado com <strong>ssh key-gen</strong>. Você pode criar quantas quiser caso precise de múltiplas chaves SSH.</p><h2 id=crie-uma-subchave-de-autenticação>Crie uma subchave de autenticação</h2><p>Você já deve ter uma chave GPG. Se não tiver, leia algum dos muitos <a href=https://docs.fedoraproject.org/en-US/quick-docs/create-gpg-keys/>bons tutoriais</a> disponíveis sobre o tema. Você vai criar a subchave editando sua chave existente. É preciso editar a chave no modo expert para acessar as opções corretas. O workflow adiciona uma nova chave onde você escolhe as capacidades, especificamente, você vai ativar apenas autenticação. O SSH normalmente usa uma chave RSA de 2048 bits que não expira (tipo 8 nas opções abaixo). Abaixo está uma versão editada do workflow. Todos os comandos foram testados no Fedora 29.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg2 --expert --edit-key &lt;KEY ID&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; addkey
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please <span style=color:#66d9ef>select</span> what kind of key you want:
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> DSA <span style=color:#f92672>(</span>sign only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>4<span style=color:#f92672>)</span> RSA <span style=color:#f92672>(</span>sign only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>5<span style=color:#f92672>)</span> Elgamal <span style=color:#f92672>(</span>encrypt only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>6<span style=color:#f92672>)</span> RSA <span style=color:#f92672>(</span>encrypt only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>7<span style=color:#f92672>)</span> DSA <span style=color:#f92672>(</span>set your own capabilities<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>8<span style=color:#f92672>)</span> RSA <span style=color:#f92672>(</span>set your own capabilities<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>10<span style=color:#f92672>)</span> ECC <span style=color:#f92672>(</span>sign only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>11<span style=color:#f92672>)</span> ECC <span style=color:#f92672>(</span>set your own capabilities<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>12<span style=color:#f92672>)</span> ECC <span style=color:#f92672>(</span>encrypt only<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>13<span style=color:#f92672>)</span> Existing key
</span></span><span style=display:flex><span>Your selection? <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Possible actions <span style=color:#66d9ef>for</span> a RSA key: Sign Encrypt Authenticate
</span></span><span style=display:flex><span>Current allowed actions: Sign Encrypt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>S<span style=color:#f92672>)</span> Toggle the sign capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>E<span style=color:#f92672>)</span> Toggle the encrypt capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>A<span style=color:#f92672>)</span> Toggle the authenticate capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>Q<span style=color:#f92672>)</span> Finished
</span></span><span style=display:flex><span>Your selection? s
</span></span><span style=display:flex><span>Your selection? e
</span></span><span style=display:flex><span>Your selection? a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Possible actions <span style=color:#66d9ef>for</span> a RSA key: Sign Encrypt Authenticate
</span></span><span style=display:flex><span>Current allowed actions: Authenticate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>S<span style=color:#f92672>)</span> Toggle the sign capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>E<span style=color:#f92672>)</span> Toggle the encrypt capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>A<span style=color:#f92672>)</span> Toggle the authenticate capability
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>Q<span style=color:#f92672>)</span> Finished
</span></span><span style=display:flex><span>Your selection? q
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RSA keys may be between <span style=color:#ae81ff>1024</span> and <span style=color:#ae81ff>4096</span> bits long.
</span></span><span style=display:flex><span>What keysize <span style=color:#66d9ef>do</span> you want? <span style=color:#f92672>(</span>2048<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Requested keysize is <span style=color:#ae81ff>2048</span> bits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please specify how long the key should be valid.
</span></span><span style=display:flex><span>0 <span style=color:#f92672>=</span> key does not expire
</span></span><span style=display:flex><span>&lt;n&gt; <span style=color:#f92672>=</span> key expires in n days
</span></span><span style=display:flex><span>&lt;n&gt;w <span style=color:#f92672>=</span> key expires in n weeks
</span></span><span style=display:flex><span>&lt;n&gt;m <span style=color:#f92672>=</span> key expires in n months
</span></span><span style=display:flex><span>&lt;n&gt;y <span style=color:#f92672>=</span> key expires in n years
</span></span><span style=display:flex><span>Key is valid <span style=color:#66d9ef>for</span>? <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Key does not expire at all
</span></span><span style=display:flex><span>Is this correct? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span>Really create? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sec rsa4096/5B6C9AA9718B1298
</span></span><span style=display:flex><span>created: 2019-03-21 expires: 2021-03-20 usage: SC
</span></span><span style=display:flex><span>trust: ultimate validity: ultimate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssb rsa4096/4CDB1F634D2FD7C
</span></span><span style=display:flex><span>created: 2019-03-21 expires: 2021-03-20 usage: E
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssb rsa4096/136F0B4E3D42CF31
</span></span><span style=display:flex><span>created: 2019-03-21 expires: never usage: A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>ultimate<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>. Marcos Azevedo <span style=color:#f92672>(</span>psylinux<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gpg&gt; quit
</span></span><span style=display:flex><span>Save changes? <span style=color:#f92672>(</span>y/N<span style=color:#f92672>)</span> y
</span></span></code></pre></td></tr></table></div></div><h2 id=habilite-a-subchave-gpg>Habilite a subchave GPG</h2><p>Quando você usa SSH, um programa chamado <strong>ssh-agent</strong> gerencia as chaves. Para usar uma chave GPG, você vai usar um programa similar, o <strong>gpg-agent</strong>, que gerencia chaves GPG. Para fazer o <strong>gpg-agent</strong> atender requisições do SSH, você precisa habilitar suporte adicionando a linha <strong>enable-ssh-support</strong> no arquivo <strong>~/.gnupg/gpg-agent.conf</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat .gnupg/gpg-agent.conf
</span></span><span style=display:flex><span>enable-ssh-support
</span></span></code></pre></td></tr></table></div></div><p>Opcionalmente, você pode pré-definir quais chaves serão usadas no SSH para não precisar usar <strong>ssh-add</strong> para carregar as chaves. Para isso, especifique as chaves no arquivo <strong>~/.gnupg/sshcontrol</strong>. As entradas nesse arquivo são
keygrips, identificadores internos que o <strong>gpg-agent</strong> usa para referenciar chaves. Diferente de um hash de chave, um keygrip se refere tanto à chave pública quanto à privada. Para encontrar o keygrip, use <strong>gpg2 -K -with-keygrip</strong>, como mostrado abaixo. Depois adicione essa linha ao arquivo <strong>sshcontrol</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg2 -K --with-keygrip
</span></span><span style=display:flex><span>/home/psylinux/.gnupg/pubring.kbx
</span></span><span style=display:flex><span>------------------------------
</span></span><span style=display:flex><span>sec rsa2048 2019-03-21 <span style=color:#f92672>[</span>SC<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2021-03-20<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>26C33AA7D4E4F7651C75AC218725AD32291EB131
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Keygrip <span style=color:#f92672>=</span> 131E27EAC300658183D3E6B94B6D9AB1778A0291
</span></span><span style=display:flex><span>uid <span style=color:#f92672>[</span>ultimate<span style=color:#f92672>]</span> Marcos Azevedo <span style=color:#f92672>(</span>psylinux<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssb rsa2048 2019-03-21 <span style=color:#f92672>[</span>E<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>expires: 2021-03-20<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Keygrip <span style=color:#f92672>=</span> 59A032B3BE1574BA0960DEDFB28FC26489383171
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssb rsa2048 2019-03-21 <span style=color:#f92672>[</span>A<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Keygrip <span style=color:#f92672>=</span> 2BE91C3C443AA29C3703D004587AD6DA9D7E40FC
</span></span></code></pre></td></tr></table></div></div><p>Depois escreva o <strong>keygrip</strong> correspondente no arquivo <strong>sshcontrol</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo 2BE91C3C443AA29C3703D004587AD6DA9D7E40FC &gt;&gt; ~/.gnupg/sshcontrol
</span></span></code></pre></td></tr></table></div></div><p>Por fim, você precisa dizer ao SSH como acessar o <strong>gpg-agent</strong>. Isso é feito alterando o valor da variável de ambiente <strong>SSH_AUTH_SOCK</strong>. As duas linhas abaixo, quando adicionadas ao seu <strong>~/.bashrc</strong>, garantem que a variável seja configurada corretamente e que o agent seja iniciado e pronto para uso.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat ~/.bashrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export SSH_AUTH_SOCK<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gpgconf --list-dirs agent-ssh-socket<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>gpgconf --launch gpg-agent
</span></span></code></pre></td></tr></table></div></div><p>Para continuar, execute esses comandos na sua sessão atual.</p><h2 id=compartilhe-sua-chave-ssh>Compartilhe sua chave SSH</h2><p>Para usar SSH, você precisa compartilhar sua chave pública com o host remoto. Você tem duas opções. Primeiro, pode rodar <strong>ssh-add -L</strong> para listar suas chaves públicas e copiá-las manualmente para o host remoto. Você também pode usar <strong>ssh-copy-id</strong>. Do ponto de vista do SSH, nada mudou.</p><h2 id=parabéns>Parabéns!</h2><p>Você agora habilitou o acesso SSH usando uma chave GPG para autenticação! O SSH continuará funcionando como esperado, e as máquinas às quais você se conecta não precisarão de mudanças de configuração. Você reduziu o número de arquivos de chave que precisa gerenciar e fazer backup com segurança, ao mesmo tempo em que habilitou a oportunidade de participar de diferentes formas de distribuição de chaves. Fique seguro e mantenha uma boa higiene de chaves!</p><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/pt/howto/howto_install_gdb_gef/ data-toggle=tooltip data-placement=top title="HowTo :: Instalar GEF (plug-in do GDB)"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><i class="text-secondary fas fa-chevron-right" style=font-size:2em></i></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>