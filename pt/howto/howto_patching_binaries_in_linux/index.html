<!doctype html><html lang=pt-br data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>HowTo :: Patch em binários no Linux - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Blog do Marcos Azevedo"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Navegação principal"><a class="me-2 fs-4" href=/pt/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Início</span>
</a><a class="mx-2 fs-4" href=/pt/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/pt/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Buscar</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Idioma><a href=/howto/howto_patching_binaries_in_linux/>English</a>
<span class=fw-semibold>Português</span></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>HowTo :: Patch em binários no Linux</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1"><small>Date: <time>2019-01-14</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
7 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/howto title=Section>HowTo</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/howto title="categories: howto">howto</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/assembly title="tags: assembly">assembly</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/nasm title="tags: nasm">nasm</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/dev title="tags: dev">dev</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/glibc title="tags: glibc">glibc</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/linux title="tags: linux">linux</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/userland title="tags: userland">userland</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/exploitation title="tags: exploitation">exploitation</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#introdução>Introdução</a></li><li><a href=#o-que-é-patching-de-binários>O Que é Patching de Binários?</a></li><li><a href=#o-que-você-vai-precisar>O Que Você Vai Precisar</a></li><li><a href=#método-1-usando-xxd-edição-hexadecimal>Método 1: Usando xxd (Edição Hexadecimal)</a><ul><li><a href=#passo-1-converter-binário-para-hex>Passo 1: Converter Binário para Hex</a></li><li><a href=#passo-2-editar-o-arquivo-hex>Passo 2: Editar o Arquivo Hex</a></li><li><a href=#passo-3-converter-hex-de-volta-para-binário>Passo 3: Converter Hex de Volta para Binário</a></li><li><a href=#passo-4-comparar-binários-usando-diffs-hexadecimais>Passo 4: Comparar Binários Usando Diffs Hexadecimais</a></li></ul></li><li><a href=#método-2-usando-bsdiff-patches-binários>Método 2: Usando bsdiff (Patches Binários)</a><ul><li><a href=#passo-1-instalar-bsdiff>Passo 1: Instalar bsdiff</a></li><li><a href=#passo-2-criar-um-patch-binário>Passo 2: Criar um Patch Binário</a></li><li><a href=#passo-3-aplicar-um-patch-binário>Passo 3: Aplicar um Patch Binário</a></li><li><a href=#passo-4-verificar-o-resultado>Passo 4: Verificar o Resultado</a></li></ul></li><li><a href=#exemplo-prático-aplicando-patch-em-um-binário-simples>Exemplo Prático: Aplicando Patch em um Binário Simples</a></li><li><a href=#solução-de-problemas>Solução de Problemas</a></li><li><a href=#melhores-práticas>Melhores Práticas</a></li><li><a href=#próximos-passos>Próximos Passos</a></li><li><a href=#veja-também>Veja Também</a></li></ul></nav></div><h2 id=introdução>Introdução</h2><p>Aprenda a aplicar patches em arquivos binários diretamente sem código-fonte usando edição hexadecimal e ferramentas de diff binário; essencial para corrigir bugs, aplicar patches de segurança ou modificar executáveis.</p><h2 id=o-que-é-patching-de-binários>O Que é Patching de Binários?</h2><p>Patching de binários é o processo de modificar arquivos executáveis compilados sem acesso ao seu código-fonte. Esta técnica é útil para:</p><ul><li><strong>Corrigir bugs</strong> em binários de produção quando recompilação não é possível</li><li><strong>Aplicar patches de segurança</strong> em sistemas legados</li><li><strong>Engenharia reversa</strong> e compreensão de como programas funcionam</li><li><strong>Desafios de CTF</strong> e pesquisa de vulnerabilidades</li><li><strong>Modificar comportamento</strong> de aplicações closed-source</li><li><strong>Criar diffs binários</strong> para distribuir patches</li></ul><p>Em vez de editar código-fonte de alto nível e recompilar, você modifica diretamente os bytes de código de máquina no arquivo executável. Isso requer compreensão de representação hexadecimal e formatos de arquivo executável.</p><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Nota Importante</div>Patching de binários deve ser realizado apenas em arquivos que você possui ou tem permissão explícita para modificar. Modificar software com direitos autorais sem permissão pode violar acordos de licenciamento ou leis.</div><h2 id=o-que-você-vai-precisar>O Que Você Vai Precisar</h2><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Pré-requisitos</div><p>Antes de aplicar patches em binários, certifique-se de ter:</p><ul><li><strong>xxd</strong> - Ferramenta de dump hexadecimal (incluída na maioria das distribuições Linux com vim-common)</li><li><strong>diff</strong> - Ferramenta de comparação de texto (padrão em todos os sistemas Linux)</li><li><strong>bsdiff</strong> - Ferramenta de diff/patch binário (instalar separadamente: <code>apt install bsdiff</code>)</li><li><strong>Cópias de backup</strong> de quaisquer arquivos que você planeja modificar</li><li><strong>Conhecimento básico de hexadecimal</strong> - Compreensão de representação hexadecimal (0x00-0xFF)</li></ul></div><h2 id=método-1-usando-xxd-edição-hexadecimal>Método 1: Usando xxd (Edição Hexadecimal)</h2><p>O comando <code>xxd</code> cria representações hexadecimais de arquivos binários que você pode editar com editores de texto, e então converter de volta para binário.</p><h3 id=passo-1-converter-binário-para-hex>Passo 1: Converter Binário para Hex</h3><p>Primeiro, crie dumps hexadecimais dos arquivos binários com os quais você quer trabalhar:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xxd prog1.bin &gt; b1.hex
</span></span></code></pre></td></tr></table></div></div><p>Isso converte <code>prog1.bin</code> em um formato hexadecimal legível salvo em <code>b1.hex</code>.</p><p><strong>Exemplo de formato de saída:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>00000000: 7f45 4c46 <span style=color:#ae81ff>0201</span> <span style=color:#ae81ff>0100</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>0000</span>  .ELF............
</span></span><span style=display:flex><span>00000010: <span style=color:#ae81ff>0200</span> 3e00 <span style=color:#ae81ff>0100</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>7010</span> <span style=color:#ae81ff>4000</span> <span style=color:#ae81ff>0000</span> <span style=color:#ae81ff>0000</span>  ..&gt;.....p.@.....
</span></span></code></pre></td></tr></table></div></div><p>Cada linha mostra:</p><ul><li><strong>Offset de byte</strong> (esquerda): Posição no arquivo</li><li><strong>Valores hexadecimais</strong> (meio): Os bytes reais em hexadecimal</li><li><strong>Representação ASCII</strong> (direita): Caracteres imprimíveis (pontos para não-imprimíveis)</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Entendendo a Saída do xxd</div>A coluna da esquerda mostra o offset do arquivo em hexadecimal. A seção do meio mostra 16 bytes por linha em formato hexadecimal. A seção da direita mostra interpretação ASCII onde <code>.</code> representa caracteres não-imprimíveis.</div><h3 id=passo-2-editar-o-arquivo-hex>Passo 2: Editar o Arquivo Hex</h3><p>Agora você pode editar <code>b1.hex</code> com qualquer editor de texto. Modifique os valores hexadecimais nas colunas do meio:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim b1.hex
</span></span><span style=display:flex><span><span style=color:#75715e># Ou use seu editor preferido</span>
</span></span><span style=display:flex><span>nano b1.hex
</span></span></code></pre></td></tr></table></div></div><p><strong>Exemplo de modificação:</strong>
Altere opcodes de instrução, valores de string, ou endereços de salto editando os bytes hexadecimais.</p><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Edite com Cuidado</div><p>Modifique apenas os valores hexadecimais nas colunas do meio. Não altere:</p><ul><li>Os offsets de byte (coluna da esquerda)</li><li>A estrutura de linha ou espaçamento</li><li>A representação ASCII (coluna da direita) - ela é auto-gerada</li></ul><p>Até um pequeno erro pode corromper o binário e torná-lo inexecutável.</p></div><h3 id=passo-3-converter-hex-de-volta-para-binário>Passo 3: Converter Hex de Volta para Binário</h3><p>Após editar, converta o arquivo hexadecimal de volta para binário:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xxd -r b1.hex new_prog1.bin
</span></span></code></pre></td></tr></table></div></div><p>A flag <code>-r</code> diz ao xxd para reverter a conversão (hex para binário).</p><h3 id=passo-4-comparar-binários-usando-diffs-hexadecimais>Passo 4: Comparar Binários Usando Diffs Hexadecimais</h3><p>Para ver o que mudou entre duas versões, crie dumps hexadecimais de ambas e compare:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xxd prog1.bin &gt; original.hex
</span></span><span style=display:flex><span>xxd new_prog1.bin &gt; modified.hex
</span></span><span style=display:flex><span>diff original.hex modified.hex
</span></span></code></pre></td></tr></table></div></div><p><strong>Ou use vimdiff para comparação visual:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vimdiff original.hex modified.hex
</span></span></code></pre></td></tr></table></div></div><p>Isso mostra exatamente quais bytes mudaram, facilitando documentar ou reverter suas modificações.</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Alternativa de Diff Binário</div><p>Para uma comparação binária mais concisa, você também pode usar:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cmp -l prog1.bin new_prog1.bin
</span></span></code></pre></td></tr></table></div></div><p>Isso mostra posições de bytes e valores que diferem entre os dois arquivos.</p></div><h2 id=método-2-usando-bsdiff-patches-binários>Método 2: Usando bsdiff (Patches Binários)</h2><p>A ferramenta <code>bsdiff</code> cria e aplica arquivos de patch binários, úteis para distribuir modificações sem compartilhar binários inteiros.</p><h3 id=passo-1-instalar-bsdiff>Passo 1: Instalar bsdiff</h3><p>Se ainda não estiver instalado:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install bsdiff      <span style=color:#75715e># Debian/Ubuntu</span>
</span></span><span style=display:flex><span>sudo yum install bsdiff      <span style=color:#75715e># Fedora/RHEL</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=passo-2-criar-um-patch-binário>Passo 2: Criar um Patch Binário</h3><p>Gere um arquivo de patch de uma versão antiga e nova de um binário:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bsdiff old_prog.bin new_prog.bin patch.bin
</span></span></code></pre></td></tr></table></div></div><p>Isso cria <code>patch.bin</code>, que contém apenas as diferenças entre os dois arquivos; muito menor que distribuir o novo binário inteiro.</p><p><strong>O que isso faz:</strong></p><ul><li>Analisa diferenças entre <code>old_prog.bin</code> e <code>new_prog.bin</code></li><li>Cria arquivo de patch comprimido contendo apenas bytes alterados</li><li>Arquivo de patch pode ser distribuído separadamente do binário completo</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tamanho do Patch</div>Arquivos de patch são tipicamente muito menores que binários completos. Por exemplo, um binário de 1MB com algumas mudanças de bytes pode produzir um arquivo de patch de apenas alguns KB.</div><h3 id=passo-3-aplicar-um-patch-binário>Passo 3: Aplicar um Patch Binário</h3><p>Para aplicar um arquivo de patch ao binário original:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bspatch old_prog.bin output.bin patch.bin
</span></span></code></pre></td></tr></table></div></div><p>Isso aplica as modificações de <code>patch.bin</code> a <code>old_prog.bin</code>, criando <code>output.bin</code> que corresponde a <code>new_prog.bin</code>.</p><p><strong>Casos de uso:</strong></p><ul><li>Distribuir correções de segurança sem compartilhar executáveis inteiros</li><li>Aplicar patches da comunidade a jogos ou aplicações</li><li>Controle de versão para arquivos binários</li><li>Minimizar tamanhos de download para atualizações</li></ul><h3 id=passo-4-verificar-o-resultado>Passo 4: Verificar o Resultado</h3><p>Sempre verifique que o binário com patch corresponde às expectativas:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Comparar tamanhos de arquivo</span>
</span></span><span style=display:flex><span>ls -lh old_prog.bin output.bin new_prog.bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Verificar integridade do arquivo se você tiver checksums</span>
</span></span><span style=display:flex><span>sha256sum old_prog.bin output.bin new_prog.bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Testar funcionalidade</span>
</span></span><span style=display:flex><span>./output.bin --version
</span></span></code></pre></td></tr></table></div></div><h2 id=exemplo-prático-aplicando-patch-em-um-binário-simples>Exemplo Prático: Aplicando Patch em um Binário Simples</h2><p>Aqui está um fluxo de trabalho completo para aplicar patch em um binário para mudar uma string:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. Criar backup</span>
</span></span><span style=display:flex><span>cp myprogram.bin myprogram.bin.backup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. Converter para hex</span>
</span></span><span style=display:flex><span>xxd myprogram.bin &gt; myprogram.hex
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. Procurar a string que você quer mudar</span>
</span></span><span style=display:flex><span>grep -n <span style=color:#e6db74>&#34;Hello&#34;</span> myprogram.hex
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. Editar o arquivo hex (mudar os bytes)</span>
</span></span><span style=display:flex><span>vim myprogram.hex
</span></span><span style=display:flex><span><span style=color:#75715e># Encontre a linha com &#34;Hello&#34; e mude para &#34;Hallo&#34; (ou o que couber)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 5. Converter de volta para binário</span>
</span></span><span style=display:flex><span>xxd -r myprogram.hex myprogram_patched.bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 6. Tornar executável</span>
</span></span><span style=display:flex><span>chmod +x myprogram_patched.bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 7. Testar</span>
</span></span><span style=display:flex><span>./myprogram_patched.bin
</span></span></code></pre></td></tr></table></div></div><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Comprimento da String Importa</div>Ao substituir strings em binários, a substituição deve ter o mesmo comprimento ou ser mais curta que a original. Strings mais longas sobrescreverão dados adjacentes e provavelmente farão o programa crashar. Preencha strings mais curtas com bytes nulos (00) se necessário.</div><h2 id=solução-de-problemas>Solução de Problemas</h2><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Problemas Comuns</div><p><strong>Problema:</strong> Binário com patch crasha ou não executa
<strong>Solução:</strong></p><ul><li>Verifique se o arquivo hex não foi corrompido durante a edição</li><li>Verifique que você não modificou offsets ou estrutura do arquivo</li><li>Certifique-se de permissões de execução: <code>chmod +x patched.bin</code></li><li>Compare com o original para identificar mudanças inesperadas</li></ul><p><strong>Problema:</strong> bspatch falha com &ldquo;corrupt patch&rdquo;
<strong>Solução:</strong></p><ul><li>Certifique-se de que o arquivo de patch não foi corrompido durante transferência</li><li>Verifique que você está usando a versão correta do binário original</li><li>Verifique permissões de arquivo em todos os arquivos envolvidos</li></ul><p><strong>Problema:</strong> Substituição de string causa crashes
<strong>Solução:</strong></p><ul><li>Strings de substituição devem ter o mesmo comprimento ou serem mais curtas</li><li>Preencha com bytes nulos (00) se for mais curta</li><li>Verifique por terminadores nulos (00) no fim das strings</li></ul><p><strong>Problema:</strong> Mudanças não parecem ter efeito
<strong>Solução:</strong></p><ul><li>Limpe quaisquer versões em cache: <code>rm -f versao_em_cache</code></li><li>Verifique que você está executando o binário com patch, não o original</li><li>Verifique se o binário tem anti-tampering ou verificação de assinatura</li></ul></div><h2 id=melhores-práticas>Melhores Práticas</h2><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Dicas de Patching de Binários</div><ul><li><strong>Sempre faça backup</strong> de arquivos originais antes de aplicar patches</li><li><strong>Documente mudanças</strong> que você faz para referência futura</li><li><strong>Teste minuciosamente</strong> após aplicar patches</li><li><strong>Use controle de versão</strong> para os próprios arquivos de patch</li><li><strong>Verifique checksums</strong> após aplicar patches</li><li><strong>Mantenha arquivos de patch pequenos</strong> modificando apenas bytes necessários</li><li><strong>Considere implicações legais</strong> antes de modificar binários</li></ul></div><h2 id=próximos-passos>Próximos Passos</h2><p>Agora que você entende patching de binários:</p><ol><li><strong>Aprenda assembly</strong>: Leia <a href=/blog/article_linux_syscalls_in_assembly.pt/>Syscalls do Linux em Assembly</a> para entender o que você está modificando</li><li><strong>Domine o GDB</strong>: Use <a href=/blog/article_getting_start_with_gdb.pt/>GDB</a> para inspecionar binários e encontrar locais de patch</li><li><strong>Estude formato ELF</strong>: Aprenda sobre estrutura de arquivo executável para aplicar patches com segurança</li><li><strong>Pratique com CTFs</strong>: Desafios Capture The Flag frequentemente requerem habilidades de patching de binários</li></ol><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Ferramentas Avançadas</div><p>Para modificação binária mais sofisticada:</p><ul><li><strong>radare2</strong> - Framework de engenharia reversa com capacidades de patching</li><li><strong>Binary Ninja</strong> - Plataforma comercial de análise binária</li><li><strong>Ghidra</strong> - Ferramenta gratuita de engenharia reversa da NSA</li><li><strong>objcopy</strong> - Ferramenta GNU para modificar arquivos objeto</li></ul></div><h2 id=veja-também>Veja Também</h2><ul><li><a href=/blog/article_getting_start_with_gdb.pt/>Começando com GDB</a> - Depure e inspecione binários para encontrar locais de patch</li><li><a href=/blog/article_linux_syscalls_in_assembly.pt/>Syscalls do Linux em Assembly</a> - Entenda execução de programas em baixo nível</li><li><a href=/blog/cheatsheet_gcc_compiling.pt/>Cheat Sheet de Compilação GCC</a> - Aprenda sobre compilação e linkagem</li><li><a href=https://linux.die.net/man/1/xxd>Manual do xxd</a> - Documentação completa do xxd</li><li><a href=http://www.daemonology.net/bsdiff/>Documentação do bsdiff</a> - Documentação oficial do bsdiff</li></ul><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><i class="text-secondary bi bi-chevron-left" style=font-size:2em></i></div><div class=ms-4><a href=/pt/howto/howto_install_pyenv/ data-toggle=tooltip data-placement=top title="HowTo :: Instalar PyEnv (Gerenciamento Simples de Versões Python)"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>