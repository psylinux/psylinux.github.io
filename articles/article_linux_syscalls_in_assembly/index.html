<!doctype html><html lang=en-us data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Article :: Using the Linux Syscalls in Assembly - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Marcos Azevedo Blog"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Primary navigation"><a class="me-2 fs-4" href=/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Home</span>
</a><a class="mx-2 fs-4" href=/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Search</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Language><span class=fw-semibold>English</span>
<a href=/pt/articles/article_linux_syscalls_in_assembly/>Português</a></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>Article :: Using the Linux Syscalls in Assembly</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1"><small>Date: <time>2018-12-28</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
6 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/articles title=Section>Articles</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/articles title="categories: articles">articles</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/assembly title="tags: assembly">assembly</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/nasm title="tags: nasm">nasm</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/dev title="tags: dev">dev</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/glibc title="tags: glibc">glibc</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/linux title="tags: linux">linux</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/userland title="tags: userland">userland</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/exploitation title="tags: exploitation">exploitation</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#overview>Overview</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#objective>Objective</a></li><li><a href=#finding-syscall-numbers>Finding Syscall Numbers</a></li><li><a href=#syscall-register-conventions>Syscall Register Conventions</a></li><li><a href=#writing-the-assembly-code>Writing the Assembly Code</a></li><li><a href=#compiling-the-code>Compiling the Code</a></li><li><a href=#adding-the-exit-syscall>Adding the Exit Syscall</a></li><li><a href=#analyzing-with-strace>Analyzing with strace</a></li><li><a href=#syscall-execution-flow>Syscall Execution Flow</a></li><li><a href=#key-takeaways>Key Takeaways</a></li><li><a href=#practice-exercises>Practice Exercises</a></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></div><h2 id=introduction>Introduction</h2><p>This hands-on tutorial teaches you how to write assembly programs that invoke Linux system calls directly, bypassing the C library and interacting with the kernel at the lowest level.</p><h2 id=overview>Overview</h2><p>When a program needs to interact with the operating system; to write to a file, allocate memory, or exit gracefully; it makes a <strong>system call</strong> (syscall). Most programmers use these indirectly through C library wrappers, but understanding how to invoke syscalls directly from assembly gives you deep insight into how programs actually work.</p><p>In this tutorial, we&rsquo;ll build a simple x64 Linux program that prints &ldquo;Hack The Planet&rdquo; to the screen using raw syscalls, with no C library dependency.</p><h2 id=prerequisites>Prerequisites</h2><p>Before starting, you should have:</p><ul><li>Basic knowledge of assembly language (NASM syntax)</li><li>Understanding of x64 registers (RAX, RDI, RSI, etc.)</li><li>NASM assembler and ld linker installed</li><li>Familiarity with C programming helps but isn&rsquo;t required</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Install NASM</div>On Debian/Ubuntu: <code>sudo apt install nasm</code>
On Fedora/RHEL: <code>sudo yum install nasm</code></div><h2 id=objective>Objective</h2><p>We&rsquo;ll build a Linux ELF64 binary that uses basic syscalls to print a message on the screen. Along the way, we&rsquo;ll learn:</p><ul><li>How to find syscall numbers</li><li>How to set up registers for syscall invocation</li><li>Why programs segfault without proper exit handling</li></ul><h2 id=finding-syscall-numbers>Finding Syscall Numbers</h2><p>Every syscall in Linux has a unique number. For x64, these are defined in a header file. Let&rsquo;s find the <code>write</code> syscall:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /usr/include/x86_64-linux-gnu/asm/unistd_64.h | grep write
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_write 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_pwrite64 18</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_writev 20</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_pwritev 296</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_process_vm_writev 311</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_pwritev2 328</span>
</span></span></code></pre></td></tr></table></div></div><p>The basic <code>write</code> syscall is number <strong>1</strong>. Now let&rsquo;s check the manual to understand its arguments:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>man <span style=color:#ae81ff>2</span> write
</span></span></code></pre></td></tr></table></div></div><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/write_syscall_1.png alt="Write syscall manual page"></figure><p>As we can see, the <code>write</code> syscall has three arguments:</p><p><strong>ssize_t write(int fd, const void *buf, size_t count);</strong></p><ol><li><strong>fd</strong> - File descriptor (0=stdin, 1=stdout, 2=stderr)</li><li><strong>buf</strong> - Pointer to the data to write</li><li><strong>count</strong> - Number of bytes to write</li></ol><h2 id=syscall-register-conventions>Syscall Register Conventions</h2><p>Reading the syscall manual, we learn how to set up x64 registers to invoke syscalls:</p><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/exit_syscall_reg_1.png alt="Syscall register setup"></figure><p><strong>Register mapping for x64 syscalls:</strong></p><ol><li><strong>RAX</strong> - Syscall number</li><li><strong>RDI</strong> - First argument</li><li><strong>RSI</strong> - Second argument</li><li><strong>RDX</strong> - Third argument</li><li><strong>R10</strong> - Fourth argument</li><li><strong>R8</strong> - Fifth argument</li><li><strong>R9</strong> - Sixth argument</li></ol><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Different from Function Calls</div>These register conventions are <strong>specific to syscalls</strong>. Regular x64 function calls use a different ABI (Application Binary Interface). Don&rsquo;t confuse the two!</div><h2 id=writing-the-assembly-code>Writing the Assembly Code</h2><p>For our program, we&rsquo;ll:</p><ul><li>Use file descriptor <strong>1</strong> (stdout) to print to the screen</li><li>Point <strong>RSI</strong> to our message string &ldquo;Hack The Planet&rdquo;</li><li>Set <strong>RDX</strong> to <strong>16</strong> (the length of our message including newline)</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>global</span> <span style=color:#66d9ef>_start</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>section</span> <span style=color:#66d9ef>.text</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_start:
</span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e>; Setting up the registers to print the message
</span></span></span><span style=display:flex><span><span style=color:#75715e>; using the &#34;write&#34; syscall
</span></span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rax</span>, <span style=color:#ae81ff>1</span>          <span style=color:#75715e>; syscall number for write
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rdi</span>, <span style=color:#ae81ff>1</span>          <span style=color:#75715e>; file descriptor 1 = stdout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rsi</span>, <span style=color:#66d9ef>msg</span>        <span style=color:#75715e>; pointer to message
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rdx</span>, <span style=color:#66d9ef>length</span>     <span style=color:#75715e>; message length
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>syscall</span>             <span style=color:#75715e>; invoke kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>section</span> <span style=color:#66d9ef>.data</span>
</span></span><span style=display:flex><span>    msg: <span style=color:#a6e22e>db</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>Hack</span> <span style=color:#66d9ef>The</span> <span style=color:#66d9ef>Planet</span><span style=color:#960050;background-color:#1e0010>&#39;</span>,<span style=color:#ae81ff>0xa</span>    <span style=color:#75715e>; message with newline
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    length: <span style=color:#a6e22e>equ</span> <span style=color:#66d9ef>$-msg</span>                 <span style=color:#75715e>; calculate length
</span></span></span></code></pre></td></tr></table></div></div><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Understanding length calculation</div>The <code>equ $-msg</code> directive calculates the length by subtracting the starting address of <code>msg</code> from the current position <code>$</code>. This automatically gives us the string length.</div><h2 id=compiling-the-code>Compiling the Code</h2><p>Let&rsquo;s compile and link this assembly code:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nasm -felf64 syscall-001.nasm -o syscall-001.o
</span></span><span style=display:flex><span>ld syscall-001.o -o syscall-001.bin
</span></span></code></pre></td></tr></table></div></div><p><strong>Flags explained:</strong></p><ul><li><code>-felf64</code> - Output format is 64-bit ELF (Executable and Linkable Format)</li><li><code>ld</code> - Links the object file into an executable binary</li></ul><p>Once we run our program with <code>./syscall-001.bin</code>, we can see that our message &ldquo;Hack The Planet&rdquo; is printed, but we get a <strong>Segmentation Fault</strong> error:</p><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/write_syscall_2.png alt="Program execution with segfault"></figure><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Why the Segfault?</div>After printing the message, our program doesn&rsquo;t know what to do next. It keeps executing whatever bytes follow in memory, eventually hitting invalid instructions or memory. We need to exit properly!</div><h2 id=adding-the-exit-syscall>Adding the Exit Syscall</h2><p>Let&rsquo;s find the exit syscall number:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /usr/include/x86_64-linux-gnu/asm/unistd_64.h | grep exit
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_exit 60</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define __NR_exit_group 231</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>exit</code> syscall is number <strong>60</strong>. Let&rsquo;s check its manual page:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>man <span style=color:#ae81ff>2</span> exit
</span></span></code></pre></td></tr></table></div></div><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/exit_syscall_1.png alt="Exit syscall manual page"></figure><p>There&rsquo;s only one argument: <strong>int status</strong> (the exit code, like 0 for success or non-zero for errors).</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>_exit</span>(<span style=color:#66d9ef>int</span> status);
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s add the exit syscall to our program. We&rsquo;ll use exit status <strong>1</strong> for testing:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#a6e22e>global</span> <span style=color:#66d9ef>_start</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>section</span> <span style=color:#66d9ef>.text</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_start:
</span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e>; Setting up the registers to print the message
</span></span></span><span style=display:flex><span><span style=color:#75715e>; using the &#34;write&#34; syscall
</span></span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rax</span>, <span style=color:#ae81ff>1</span>          <span style=color:#75715e>; syscall number for write
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rdi</span>, <span style=color:#ae81ff>1</span>          <span style=color:#75715e>; file descriptor 1 = stdout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rsi</span>, <span style=color:#66d9ef>msg</span>        <span style=color:#75715e>; pointer to message
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rdx</span>, <span style=color:#66d9ef>length</span>     <span style=color:#75715e>; message length
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>syscall</span>             <span style=color:#75715e>; invoke kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e>; Setting up the registers to call the &#34;exit&#34; syscall
</span></span></span><span style=display:flex><span><span style=color:#75715e>; and exit normally with return 1
</span></span></span><span style=display:flex><span><span style=color:#75715e>; Note: if we comment this the process will finish with
</span></span></span><span style=display:flex><span><span style=color:#75715e>; Segmentation Fault error
</span></span></span><span style=display:flex><span><span style=color:#75715e>;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rax</span>, <span style=color:#ae81ff>60</span>         <span style=color:#75715e>; syscall number for exit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>mov</span> <span style=color:#66d9ef>rdi</span>, <span style=color:#ae81ff>1</span>          <span style=color:#75715e>; exit status code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>syscall</span>             <span style=color:#75715e>; invoke kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>section</span> <span style=color:#66d9ef>.data</span>
</span></span><span style=display:flex><span>    msg: <span style=color:#a6e22e>db</span> <span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>Hack</span> <span style=color:#66d9ef>The</span> <span style=color:#66d9ef>Planet</span><span style=color:#960050;background-color:#1e0010>&#39;</span>,<span style=color:#ae81ff>0xa</span>
</span></span><span style=display:flex><span>    length: <span style=color:#a6e22e>equ</span> <span style=color:#66d9ef>$-msg</span>
</span></span></code></pre></td></tr></table></div></div><p>Now compile again:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nasm -felf64 syscall-001.nasm -o syscall-001.o
</span></span><span style=display:flex><span>ld syscall-001.o -o syscall-001.bin
</span></span></code></pre></td></tr></table></div></div><p>After running <code>./syscall-001.bin</code>, we can verify the exit status is <strong>1</strong> as we designed:</p><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/exit_syscall_2.png alt="Program execution with exit status 1"></figure><p>Perfect! No segfault. The program exits cleanly.</p><h2 id=analyzing-with-strace>Analyzing with strace</h2><p>If we use <code>strace</code> to analyze this ELF64 binary, we see interesting details. When we run the binary, the shell uses <code>execve</code> with our binary as an argument along with environment variables:</p><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/exit_syscall_3.png alt="Strace output showing execve"></figure><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/execve_1.png alt="Execve syscall details"></figure><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Understanding strace output</div>Strace shows us the exact syscalls our program makes, including their arguments and return values. This is invaluable for debugging and understanding program behavior. Read our <a href=/blog/article_debugging_with_strace/>Debugging with strace</a> article to learn more.</div><hr><h2 id=syscall-execution-flow>Syscall Execution Flow</h2><p>Here&rsquo;s how syscalls work under the hood:</p><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/syscall_execution_1.png alt="Syscall execution flow diagram"></figure><figure id=figure-1 class="mt-4 pt-2"><img class="mw-100 rounded" src=/pics/syscall_execution_2.png alt="Syscall execution details"></figure><p><strong>The process:</strong></p><ol><li>User program sets up registers (RAX for syscall number, RDI/RSI/RDX for arguments)</li><li><code>syscall</code> instruction triggers a context switch to kernel mode</li><li>Kernel validates arguments and executes the requested operation</li><li>Kernel returns control to userland with result in RAX</li><li>Program continues execution</li></ol><h2 id=key-takeaways>Key Takeaways</h2><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Quick Summary</div><ul><li><strong>Syscalls</strong> are the interface between userland programs and the kernel</li><li><strong>x64 syscall numbers</strong> are defined in <code>/usr/include/x86_64-linux-gnu/asm/unistd_64.h</code></li><li><strong>Register convention</strong>: RAX=syscall number, RDI/RSI/RDX/R10/R8/R9 for arguments</li><li><strong>Always call exit</strong> to terminate programs gracefully (syscall 60 on x64)</li><li><strong>strace</strong> is essential for understanding and debugging syscall behavior</li><li><strong>No C library needed</strong> - you can interact directly with the kernel</li></ul></div><h2 id=practice-exercises>Practice Exercises</h2><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Try It Yourself</div><ol><li>Modify the program to write to stderr (file descriptor 2) instead of stdout</li><li>Create a program that uses the <code>read</code> syscall (number 0) to get user input</li><li>Write a program that opens a file using the <code>open</code> syscall (number 2)</li><li>Add error checking by examining the return value in RAX after each syscall</li><li>Use strace on system utilities like <code>ls</code> and identify the syscalls they make</li></ol></div><h2 id=further-reading>Further Reading</h2><ul><li><a href=/blog/article_debugging_with_strace/>Debugging with strace</a> - Learn to trace and debug syscalls</li><li><a href=/blog/article_getting_start_with_gdb/>Getting Started with GDB</a> - Debug your assembly programs</li><li><a href=/blog/cheatsheet_gcc_compiling/>GCC Compiling Cheat Sheet</a> - Compilation and linking reference</li><li><a href=https://man7.org/linux/man-pages/man2/syscalls.2.html>Linux Syscall Reference</a> - Complete syscall documentation</li><li><a href=https://refspecs.linuxbase.org/elf/x86_64-abi-0.99.pdf>x64 ABI Documentation</a> - Official x86-64 calling conventions</li></ul><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/articles/article_debugging_with_strace/ data-toggle=tooltip data-placement=top title="Article :: Debugging with strace"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><a href=/articles/article_getting_start_with_gdb/ data-toggle=tooltip data-placement=top title="Article :: Getting Started with GDB"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>