<!doctype html><html lang=en-us data-bs-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>ELF Internals and Binutils: Seeing What the Compiler Produced - Marcos Azevedo (aka psylinux)</title><meta name=description content><meta name=author content="Marcos Azevedo Blog"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css><link rel=stylesheet href=/css/khata.css><link rel=stylesheet href=/css/code-highlight.css><script src=/js/khata.js></script><script src=/js/code-copy.js></script></head><body class="mx-auto text-white d-flex flex-column p-2"><nav aria-label="Primary navigation"><a class="me-2 fs-4" href=/><i class="bi bi-house-door-fill" aria-hidden=true></i>
<span class=visually-hidden>Home</span>
</a><a class="mx-2 fs-4" href=/menu><i class="bi bi-list" aria-hidden=true></i>
<span class=visually-hidden>Menu</span>
</a><a class="ms-2 fs-4" href=/search><i class="bi bi-search" aria-hidden=true></i>
<span class=visually-hidden>Search</span></a><div class="language-switcher d-inline-flex align-items-center gap-2 ms-3" aria-label=Language><span class=fw-semibold>English</span>
<a href=/pt/series/experimenting-with-risc-v/06-elf-and-binutils/>Português</a></div></nav><main class="flex-grow-1 d-flex flex-column"><article><h1 class=my-4>ELF Internals and Binutils: Seeing What the Compiler Produced</h1><div class="metadata-panel p-2 mb-3 rounded border"><div class="metadata-value mb-1">Author: Marcos Azevedo</div><div class="metadata-value mb-1"><small>Date: <time>2026-01-20</time></small></div><div class="metadata-value mb-1"><small>Reading Time:
10 mins</small></div><div class="metadata-value mb-1"><small>Section:
<a href=/series title=Section>Series</a></small></div><div class="metadata-value mb-1"><small>Categories:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/categories/series title="categories: series">series</a></small></div><div class="metadata-value mb-1"><small>Tags:
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/c-lang title="tags: c-lang">c-lang</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/programming title="tags: programming">programming</a>
<a class="px-1 mx-1 rounded border border-secondary bg-taxa" href=/tags/risc-v title="tags: risc-v">risc-v</a></small></div></div><div class="TableOfContents border rounded p-2 ms-2 mb-2"><nav id=TableOfContents><ul><li><a href=#1-tldr>1. TL;DR</a></li><li><a href=#2-prerequisites>2. Prerequisites</a></li><li><a href=#3-elf-in-one-diagram>3. ELF in one diagram</a></li><li><a href=#4-the-core-tools-and-what-each-is-for>4. The “core” tools and what each is for</a><ul><li><a href=#41-readelf-structure>4.1. readelf (structure)</a></li><li><a href=#42-objdump-content>4.2. objdump (content)</a></li><li><a href=#43-nm-symbols>4.3. nm (symbols)</a></li><li><a href=#44-objcopy-transform>4.4. objcopy (transform)</a></li><li><a href=#45-xxd--hexdump-raw-bytes>4.5. xxd / hexdump (raw bytes)</a></li></ul></li><li><a href=#5-hands-on-inspect-a-bare-metal-sample-elf>5. Hands-on: inspect a bare-metal sample ELF</a><ul><li><a href=#51-build-a-sample-elf>5.1. Build a sample ELF</a></li><li><a href=#52-show-the-elf-header>5.2. Show the ELF header</a></li><li><a href=#53-show-sections>5.3. Show sections</a></li><li><a href=#54-show-segments-program-headers>5.4. Show segments (program headers)</a></li></ul></li><li><a href=#6-where-is-main-symbols>6. Where is main? (symbols)</a><ul><li><a href=#61-fast-nm>6.1. Fast: nm</a></li><li><a href=#62-richer-readelf--s>6.2. Richer: readelf -s</a></li></ul></li><li><a href=#7-disassembly-you-can-trust>7. Disassembly you can trust</a><ul><li><a href=#71-basic-disassembly>7.1. Basic disassembly</a></li><li><a href=#72-prefer-numeric-registers--no-pseudo-instruction-aliases>7.2. Prefer: numeric registers + no pseudo-instruction aliases</a></li><li><a href=#73-find-a-function-in-disassembly>7.3. Find a function in disassembly</a></li></ul></li><li><a href=#8-match-instructions-to-bytes-hexdump-workflow>8. Match instructions to bytes (hexdump workflow)</a><ul><li><a href=#81-step-a-find-text-mapping>8.1. Step A: find .text mapping</a></li><li><a href=#82-step-b-compute-a-file-offset>8.2. Step B: compute a file offset</a></li><li><a href=#83-step-c-view-bytes>8.3. Step C: view bytes</a></li></ul></li><li><a href=#9-relocations-addresses-not-final-yet>9. Relocations: “addresses not final yet”</a><ul><li><a href=#91-the-basic-idea-with-a-mental-model>9.1. The basic idea (with a mental model)</a></li><li><a href=#92-anatomy-of-a-relocation-entry>9.2. Anatomy of a relocation entry</a></li><li><a href=#93-see-relocations-in-a-real-o>9.3. See relocations in a real <code>.o</code></a></li><li><a href=#94-what-happens-after-linking>9.4. What happens after linking?</a></li></ul></li><li><a href=#10-elf--raw-binary-and-why-addresses-disappear>10. ELF → raw binary (and why addresses disappear)</a></li><li><a href=#11-exercises>11. Exercises</a><ul><li><a href=#111-how-to-test-your-answers>11.1. How to test your answers</a></li></ul></li><li><a href=#12-summary>12. Summary</a><ul><li><a href=#121-read-next>12.1. Read Next</a></li></ul></li></ul></nav></div><h2 id=1-tldr>1. TL;DR</h2><ul><li>You’ll learn how an <strong>ELF (Executable and Linkable Format)</strong> file is structured and how that structure maps to <strong>runtime memory</strong>.</li><li>You’ll practice using <code>readelf</code>, <code>objdump</code>, <code>nm</code>, <code>objcopy</code>, <code>xxd</code>, and <code>hexdump</code> to answer practical questions:<ul><li>“What is the entry point?”</li><li>“Where is this function?”</li><li>“Which bytes correspond to that instruction?”</li><li>“Why does this address exist in disassembly but not in the file?”</li></ul></li><li>You’ll build a mental model of <strong>sections vs segments</strong>, <strong>symbols</strong>, and <strong>relocations</strong>.</li></ul><p>If you can read ELF structure confidently, reverse engineering and debugging become dramatically easier. You stop guessing!</p><hr><h2 id=2-prerequisites>2. Prerequisites</h2><ul><li><code>riscv64-unknown-elf-gcc</code></li><li><code>readelf</code></li><li><code>objdump</code></li><li><code>nm</code></li><li><code>objcopy</code></li><li><code>xxd</code></li><li><code>hexdump</code></li></ul><h2 id=3-elf-in-one-diagram>3. ELF in one diagram</h2><p>Think of an ELF as having <strong>two different “views”</strong> of the same data:</p><ul><li><strong>Sections</strong>: developer / linker view (good for symbols, disassembly, and static analysis)</li><li><strong>Segments</strong>: loader view (what gets mapped into memory when the program runs)</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ELF file
</span></span><span style=display:flex><span> ├─ ELF header
</span></span><span style=display:flex><span> ├─ Program header table  (segments: loader view)
</span></span><span style=display:flex><span> │    ├─ PT_LOAD (text)
</span></span><span style=display:flex><span> │    ├─ PT_LOAD (data)
</span></span><span style=display:flex><span> │    └─ ...
</span></span><span style=display:flex><span> ├─ Section header table  (sections: linker view)
</span></span><span style=display:flex><span> │    ├─ .text
</span></span><span style=display:flex><span> │    ├─ .rodata
</span></span><span style=display:flex><span> │    ├─ .data
</span></span><span style=display:flex><span> │    ├─ .bss
</span></span><span style=display:flex><span> │    ├─ .symtab / .strtab
</span></span><span style=display:flex><span> │    └─ ...
</span></span><span style=display:flex><span> └─ Raw section contents
</span></span></code></pre></td></tr></table></div></div><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Note</div>Not all ELFs include a section header table (e.g., some stripped or embedded images). Program headers are what loaders actually need.</div><h2 id=4-the-core-tools-and-what-each-is-for>4. The “core” tools and what each is for</h2><h3 id=41-readelf-structure>4.1. readelf (structure)</h3><ul><li>Read headers, sections, segments, symbols, relocations.</li><li>Best tool to answer “what is in this ELF?”</li></ul><h3 id=42-objdump-content>4.2. objdump (content)</h3><ul><li>Disassemble code (<code>-d</code>)</li><li>Dump section bytes (<code>-s</code>)</li><li>Show symbol table (<code>-t</code>)</li></ul><h3 id=43-nm-symbols>4.3. nm (symbols)</h3><ul><li>Quick “list symbols and addresses”</li></ul><h3 id=44-objcopy-transform>4.4. objcopy (transform)</h3><ul><li>Convert ELF → raw binary (<code>-O binary</code>)</li><li>Extract a section</li></ul><h3 id=45-xxd--hexdump-raw-bytes>4.5. xxd / hexdump (raw bytes)</h3><ul><li>Verify byte-level hypotheses (endianness, offsets)</li></ul><h2 id=5-hands-on-inspect-a-bare-metal-sample-elf>5. Hands-on: inspect a bare-metal sample ELF</h2><h3 id=51-build-a-sample-elf>5.1. Build a sample ELF</h3><p>We will inspect a small bare-metal program that writes over UART:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-gcc -O0 -g -ffreestanding -nostdlib <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -march<span style=color:#f92672>=</span>rv32im -mabi<span style=color:#f92672>=</span>ilp32 -T src/link.ld <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  src/start.s src/uart.c src/lab.c -o build/lab_rv32.elf
</span></span></code></pre></td></tr></table></div></div><h3 id=52-show-the-elf-header>5.2. Show the ELF header</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -h build/lab_rv32.elf
</span></span></code></pre></td></tr></table></div></div><p>Look for:</p><ul><li><strong>Class</strong>: <code>ELF32</code></li><li><strong>Machine</strong>: <code>RISC-V</code></li><li><strong>Entry point address</strong>: the first instruction the loader jumps to</li></ul><h3 id=53-show-sections>5.3. Show sections</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -S build/lab_rv32.elf
</span></span></code></pre></td></tr></table></div></div><p>Key fields to understand:</p><ul><li><strong>Name</strong>: e.g., <code>.text</code>, <code>.rodata</code>, <code>.data</code>, <code>.bss</code></li><li><strong>Addr</strong>: virtual address (VMA (Virtual Memory Address) when loaded)</li><li><strong>Off</strong>: file offset (where bytes live in the file)</li><li><strong>Size</strong>: section size</li><li><strong>Flags</strong>: <code>AX</code> (alloc + execute), <code>WA</code> (write + alloc)</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tip</div><p>When you need to map “this runtime address” → “which bytes in the file”, you use:</p><p><code>file_offset = section_off + (address - section_addr)</code></p><p>Example with <code>build/lab_rv32.elf</code> (from <code>readelf -S</code>):</p><ul><li><code>.text</code> has <code>Addr=0x80000000</code> and <code>Off=0x001000</code></li><li>If you want runtime address <code>0x80000124</code> (the start of <code>uart_puthex32</code>):</li></ul><p><code>file_offset = 0x001000 + (0x80000124 - 0x80000000) = 0x001124</code></p><p>How do I prove it?</p><ul><li>Dump file bytes at that offset:</li></ul><p><code>xxd -s 0x1124 -g 1 -l 16 build/lab_rv32.elf</code></p><ul><li>Compare with the disassembly at that runtime address:</li></ul><p><code>riscv64-unknown-elf-objdump -d -M numeric,no-aliases build/lab_rv32.elf | rg -n '80000124'</code></p><p>Command syntax:</p><ul><li><code>xxd -e -s 0x1124 -g 1 -l 16 build/lab_rv32.elf</code><ul><li><code>-e</code>: switch to little-endian mode</li><li><code>-s 0x1124</code>: seek to byte offset <code>0x1124</code> from the start of the file</li><li><code>-g 1</code>: group bytes in 1-byte units</li><li><code>-l 16</code>: show 16 bytes</li></ul></li><li><code>riscv64-unknown-elf-objdump -d -M numeric,no-aliases build/lab_rv32.elf</code><ul><li><code>-d</code>: disassemble all executable sections</li><li><code>-M numeric,no-aliases</code>: show numeric registers and avoid pseudo-instruction aliases</li></ul></li><li><code>rg -n '80000124'</code><ul><li><code>-n</code>: include line numbers in the match output</li></ul></li></ul></div><h3 id=54-show-segments-program-headers>5.4. Show segments (program headers)</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -l build/lab_rv32.elf
</span></span></code></pre></td></tr></table></div></div><p>In the segment list, focus on:</p><ul><li><code>LOAD</code> segments: these are mapped into memory</li><li><code>VirtAddr</code> / <code>PhysAddr</code>: where they appear at runtime</li><li><code>FileSiz</code> / <code>MemSiz</code>: file bytes vs in-memory size</li></ul><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Important</div><code>.bss</code> usually has <strong>no bytes in the file</strong> (it’s “zero-initialized” in memory). That’s why <code>MemSiz</code> can be larger than <code>FileSiz</code>.</div><h2 id=6-where-is-main-symbols>6. Where is main? (symbols)</h2><h3 id=61-fast-nm>6.1. Fast: nm</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nm -n build/lab_rv32.elf | grep -E <span style=color:#e6db74>&#39; main$| add_u32$&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>-n</code> sorts by address</li><li>Symbol type letters matter:<ul><li><code>T/t</code>: text (code)</li><li><code>D/d</code>: initialized data</li><li><code>B/b</code>: BSS</li></ul></li></ul><h3 id=62-richer-readelf--s>6.2. Richer: readelf -s</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -s build/lab_rv32.elf | grep -E <span style=color:#e6db74>&#39; main$| add_u32$| mmio_fake$&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>You’ll see:</p><ul><li>symbol value (address)</li><li>size</li><li>binding (local/global)</li><li>section index</li></ul><h2 id=7-disassembly-you-can-trust>7. Disassembly you can trust</h2><h3 id=71-basic-disassembly>7.1. Basic disassembly</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-objdump -d build/lab_rv32.elf | less
</span></span></code></pre></td></tr></table></div></div><h3 id=72-prefer-numeric-registers--no-pseudo-instruction-aliases>7.2. Prefer: numeric registers + no pseudo-instruction aliases</h3><p>Pseudo-instructions can hide what the CPU actually executes.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-objdump -d -M numeric,no-aliases build/lab_rv32.elf | less
</span></span></code></pre></td></tr></table></div></div><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Note</div>RISC-V assembly is often shown with pseudo-instructions like <code>ret</code> (which is really <code>jalr x0, x1, 0</code>). Seeing the “real” form helps debugging.</div><h3 id=73-find-a-function-in-disassembly>7.3. Find a function in disassembly</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>grep -n <span style=color:#e6db74>&#34;&lt;add_u32&gt;&#34;</span> -n &lt;<span style=color:#f92672>(</span>riscv64-unknown-elf-objdump -d -M numeric,no-aliases build/lab_rv32.elf<span style=color:#f92672>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=8-match-instructions-to-bytes-hexdump-workflow>8. Match instructions to bytes (hexdump workflow)</h2><p>This is a practical reverse engineering skill:</p><ol><li>Identify an instruction address in <code>objdump</code> (e.g. <code>main</code>).</li><li>Convert that address → file offset using section info.</li><li>Inspect raw bytes at that offset.</li></ol><h3 id=81-step-a-find-text-mapping>8.1. Step A: find .text mapping</h3><p>You want <code>.text</code> <strong>Addr</strong> and <strong>Off</strong>.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -S build/lab_rv32.elf | rg -n <span style=color:#e6db74>&#39;\.text&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Output:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>6:  <span style=color:#f92672>[</span> 1<span style=color:#f92672>]</span> .text   PROGBITS   <span style=color:#ae81ff>80000000</span> <span style=color:#ae81ff>001000</span> <span style=color:#ae81ff>000344</span> <span style=color:#ae81ff>00</span>  AX  <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>4</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=82-step-b-compute-a-file-offset>8.2. Step B: compute a file offset</h3><p>First, get the address of <code>main</code>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nm -n build/lab_rv32.elf | rg <span style=color:#e6db74>&#39; main$&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Output:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>80000280</span> T main
</span></span></code></pre></td></tr></table></div></div><p>On this ELF, <code>main</code> is at <code>0x80000280</code>.<br>From the section headers, <code>.text</code> has:</p><ul><li><code>Addr = 0x80000000</code></li><li><code>Off = 0x001000</code></li></ul><p>Then:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>offset = 0x001000 + (0x80000280 - 0x80000000)
</span></span><span style=display:flex><span>       = 0x001280
</span></span></code></pre></td></tr></table></div></div><p>Or let <code>bc</code> do the math:</p><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tip</div>The <code>bc</code> is the standard Unix command-line calculator (supports arbitrary precision and different number bases).</div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bc -q <span style=color:#f92672>&lt;&lt;&lt;</span> <span style=color:#e6db74>&#39;obase=16; ibase=16; 001000 + (80000280 - 80000000)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1280</span>
</span></span></code></pre></td></tr></table></div></div><p>Notes on <code>bc</code>:</p><ul><li><code>ibase=16</code> makes <code>bc</code> parse the input numbers as hex.</li><li><code>obase=16</code> prints the result in hex.</li><li>Set <code>obase</code> <strong>before</strong> <code>ibase</code> so <code>16</code> itself isn’t interpreted as hex (<code>0x16</code>).</li><li>Result is <code>1280</code> in hex.</li></ul><h3 id=83-step-c-view-bytes>8.3. Step C: view bytes</h3><div class="alert alert-danger my-4" role=alert><div class="fw-bold mb-2">Important</div>RISC-V instructions are little-endian in memory. The “byte order” you see in a <code>objdump</code> output is exactly what the CPU fetches.</div><ol><li>Dump <code>.text</code> bytes with <code>objdump</code>:</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-objdump -s -j .text build/lab_rv32.elf | head -n <span style=color:#ae81ff>20</span>
</span></span></code></pre></td></tr></table></div></div><p>Output:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>build/lab_rv32.elf:     file format elf32-littleriscv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Contents of section .text:
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000000</span> <span style=color:#ae81ff>17010001</span> <span style=color:#ae81ff>13010100</span> <span style=color:#ae81ff>93810100</span> <span style=color:#ae81ff>97020000</span>  ................
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000010</span> <span style=color:#ae81ff>93820235</span> <span style=color:#ae81ff>13834180</span> <span style=color:#ae81ff>63886200</span> 23a00200  ...5..A.c.b.#...
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000020</span> <span style=color:#ae81ff>93824200</span> e3cc62fe ef008025 <span style=color:#ae81ff>73005010</span>  ..B...b....%s.P.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000030</span> 6ff0dfff 130101fd <span style=color:#ae81ff>23268102</span> <span style=color:#ae81ff>13040103</span>  o.......#&amp;......
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000040</span> 232ea4fc 8327c4fd 93f7f700 2326f4fe  <span style=color:#75715e>#....&#39;......#&amp;..</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000050</span> 0327c4fe <span style=color:#ae81ff>93079000</span> 63ece700 8327c4fe  .<span style=color:#e6db74>&#39;......c....&#39;</span>..
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000060</span> 93f7f70f <span style=color:#ae81ff>93870703</span> 93f7f70f 6f004001  ............o.@.
</span></span><span style=display:flex><span> <span style=color:#ae81ff>80000070</span> 8327c4fe 93f7f70f <span style=color:#ae81ff>93877705</span> 93f7f70f  .<span style=color:#e6db74>&#39;........w.....
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 80000080 a305f4fe b7070010 0347b4fe 2380e700  .........G..#...
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 80000090 13000000 0324c102 13010103 67800000  .....$......g...
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 800000a0 130101fe 232e8100 13040102 93070500  ....#...........
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 800000b0 a307f4fe b7070010 0347f4fe 2380e700  .........G..#...
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 800000c0 13000000 0324c101 13010102 67800000  .....$......g...
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 800000d0 130101fe 232e1100 232c8100 13040102  ....#...#,......
</span></span></span><span style=display:flex><span><span style=color:#e6db74> 800000e0 2326a4fe 6f00c001 8327c4fe 13871700  #&amp;..o....&#39;</span>......
</span></span><span style=display:flex><span> 800000f0 2326e4fe 83c70700 <span style=color:#ae81ff>13850700</span> eff05ffa  <span style=color:#75715e>#&amp;............_.</span>
</span></span></code></pre></td></tr></table></div></div><p>In this <code>objdump -s</code> output, the left‑hand address (for example <code>0x800000d0</code>) is the <strong>runtime/VMA address</strong> of those bytes when <code>.text</code> is loaded into memory, <strong>not</strong> a file offset. It’s the section’s load address plus the offset within the section.</p><ol><li>To inspect the bytes that correspond specifically to <code>main</code> (at <code>0x80000280</code> → file offset <code>0x1280</code>):</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xxd -s 0x1280 -g <span style=color:#ae81ff>1</span> -l <span style=color:#ae81ff>16</span> build/lab_rv32.elf
</span></span></code></pre></td></tr></table></div></div><p>Output:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>00001280: <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>01</span> fe <span style=color:#ae81ff>23</span> 2e <span style=color:#ae81ff>11</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>23</span> 2c <span style=color:#ae81ff>81</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>13</span> <span style=color:#ae81ff>04</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>02</span>  ....#...#,......
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>What is the equivalent view in the <code>xxd</code>/<code>hexdump</code>?</li></ol><p>The <code>objdump -j .text</code> finds the <code>.text</code> section by name in the ELF section table and dumps the bytes that belong to it. In the other hand, <code>xxd</code> and <code>hexdump</code> are section‑agnostic; they just dump raw bytes starting at a file offset. In this ELF, <code>.text</code> begins at <strong>file offset <code>0x1000</code></strong> (as seen in the section headers), so these commands are equivalent views of the same bytes:</p><ul><li>View using <code>xxd</code>:</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>xxd -s 0x1000 -g <span style=color:#ae81ff>1</span> build/lab_rv32.elf | head -n <span style=color:#ae81ff>20</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>View using <code>hexdump</code>:</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hexdump -C -s 0x1000 build/lab_rv32.elf | head -n <span style=color:#ae81ff>20</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>To verify the offset for your file, check the <code>.text</code> entry in the section headers:</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -S build/lab_rv32.elf | rg <span style=color:#e6db74>&#39;\.text&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>If the <code>.text</code> offset is different, replace <code>0x1000</code> with that value.</p><h2 id=9-relocations-addresses-not-final-yet>9. Relocations: “addresses not final yet”</h2><p>A <strong>relocation</strong> is a note from the assembler to the linker that says:
“I had to put <em>something</em> in this instruction or data slot, but I don’t know the final address yet. Please fix it later.”</p><p>This happens because <code>.o</code> files are built <strong>before</strong> the linker decides where everything lives in memory.</p><h3 id=91-the-basic-idea-with-a-mental-model>9.1. The basic idea (with a mental model)</h3><p>When you write:</p><ul><li>a call to a function (<code>call foo</code>)</li><li>a reference to a global (<code>la t0, global_var</code>)</li></ul><p>The assembler can’t know the final address of <code>foo</code> or <code>global_var</code>.<br>So it:</p><ol><li>Emits a <strong>placeholder</strong> in the instruction/data,</li><li>Adds a <strong>relocation entry</strong> that describes how to patch it later.</li></ol><p>At link time, the linker reads those entries, computes the real addresses, and rewrites the bytes.</p><h3 id=92-anatomy-of-a-relocation-entry>9.2. Anatomy of a relocation entry</h3><p>A relocation usually includes:</p><ul><li><strong>offset</strong>: where in the section to patch</li><li><strong>type</strong>: how to patch it (absolute, PC‑relative, hi/lo pair, etc.)</li><li><strong>symbol</strong>: what the patch should point to</li><li><strong>addend</strong>: extra constant to add (RISC‑V typically uses <strong>RELA</strong>, which stores the addend explicitly)</li></ul><div class="alert alert-info my-4" role=alert><div class="fw-bold mb-2">Note</div>Think of the relocation as a tiny recipe: “take the address of this symbol, apply this rule, and write it here.”</div><h3 id=93-see-relocations-in-a-real-o>9.3. See relocations in a real <code>.o</code></h3><p>Build an object file:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-gcc -O0 -g -ffreestanding -nostdlib -march<span style=color:#f92672>=</span>rv32im -mabi<span style=color:#f92672>=</span>ilp32 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -c src/lab.c -o build/lab.o
</span></span></code></pre></td></tr></table></div></div><p>Inspect relocation entries:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -r build/lab.o
</span></span></code></pre></td></tr></table></div></div><p>Helpful companion views:</p><ol><li>Symbol table (names + addresses in .o)</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>readelf -s build/lab.o
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Disassembly + relocations inline</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-objdump -dr build/lab.o
</span></span></code></pre></td></tr></table></div></div><p>What to look for in <code>readelf -r</code>:</p><ul><li><strong>Offset</strong>: the exact byte position to patch</li><li><strong>Info/Type</strong>: the relocation kind (architecture‑specific)</li><li><strong>Symbol</strong>: what it targets (<code>foo</code>, <code>global_var</code>, etc.)</li><li><strong>Addend</strong>: constant adjustment (if present)</li></ul><h3 id=94-what-happens-after-linking>9.4. What happens after linking?</h3><ul><li>In a final, <strong>fully linked</strong> bare‑metal ELF, most relocations are <strong>resolved</strong> (the bytes are already patched).</li><li>In a <strong>shared</strong> or <strong>dynamically linked</strong> ELF, some relocations remain for the loader to fix at runtime.</li></ul><div class="alert alert-success my-4" role=alert><div class="fw-bold mb-2">Tip</div>If you ever wonder “how does the linker connect this call to that function?”, relocations are the answer.</div><h2 id=10-elf--raw-binary-and-why-addresses-disappear>10. ELF → raw binary (and why addresses disappear)</h2><p>Convert to a flat binary:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>riscv64-unknown-elf-objcopy -O binary build/lab_rv32.elf lab_rv32.bin
</span></span></code></pre></td></tr></table></div></div><p>Now check:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -l build/lab_rv32.elf lab_rv32.bin
</span></span></code></pre></td></tr></table></div></div><p>Why <code>.bin</code> is smaller:</p><ul><li>It’s only <strong>loadable bytes</strong>; no symbol tables, no section headers.</li></ul><div class="alert alert-warning my-4" role=alert><div class="fw-bold mb-2">Warning</div>A raw <code>.bin</code> has <strong>no inherent addresses</strong>. You must know (or guess) its load address from a bootloader, memory map, or surrounding firmware.</div><h2 id=11-exercises>11. Exercises</h2><ol><li>Use <code>readelf -h</code> to find the <strong>entry point</strong> of <code>build/lab_rv32.elf</code>.</li><li>Use <code>nm -n</code> to find the address of <code>add_u32</code> and locate it in <code>objdump</code>.</li><li>Pick one instruction inside <code>add_u32</code> and find the exact bytes in the ELF using the section offset method.</li><li>Build <code>lab.o</code> and list relocations; explain in one sentence what each relocation is trying to fix.</li></ol><h3 id=111-how-to-test-your-answers>11.1. How to test your answers</h3><ul><li>Can you point to a <strong>specific file offset</strong> that contains the bytes for an instruction at a <strong>specific virtual address</strong>?</li><li>Can you explain why <code>.bss</code> has size in memory but not in the file?</li></ul><hr><h2 id=12-summary>12. Summary</h2><p>You learned to navigate ELF structure and use binutils to connect:</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart LR
  A[symbols] --&gt; B[disassembly] --&gt; C[raw bytes] --&gt; D[runtime addresses]
</code></pre><h3 id=121-read-next>12.1. Read Next</h3><p>In the <code>readelf -l</code> output, you might have noticed <code>Align 0x1000</code>. Why does the hardware care about this number? And does your code <em>really</em> live at <code>0x80000000</code>?
Check out <strong><a href=/series/experimenting-with-risc-v/07-memory-and-paging/>Chapter 7: Memory, Paging, and The Hardware Illusion</a></strong> to uncover the secrets of Virtual Memory.</p><p>Next: <strong>RV32 ABI + C types</strong> we’ll connect C-level data layouts (sizes, alignment, structs) to the exact loads/stores you see in assembly.</p><div class=mt-4><script src=https://giscus.app/client.js data-repo=psylinux/psylinux.github.io data-repo-id=R_kgDORCdA4Q data-category=Comments data-category-id=DIC_kwDORCdA4c4C1fwh data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><div class=footer><div class="mb-4 d-flex flex-row justify-content-around"><div class=mr-4><a href=/series/experimenting-with-risc-v/05-basic-assembly/ data-toggle=tooltip data-placement=top title="Basic RISC-V Assembly Instructions"><i class="bi bi-chevron-left" style=font-size:2em></i></a></div><div class=ms-4><a href=/series/experimenting-with-risc-v/07-memory-and-paging/ data-toggle=tooltip data-placement=top title="Memory, Paging, and The Hardware Illusion"><i class="bi bi-chevron-right" style=font-size:2em></i></a></div></div><footer class="border-top border-light py-2 d-flex flex-row flex-wrap justify-content-between"><div class=copyright><small>psylinux</small></div><div><small>Copyrighted © Marcos Azevedo, 2025.</small></div></footer><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b1b9cb012238436c9efbac840abc1907"}'></script></div></body></html>